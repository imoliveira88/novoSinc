
select * from ALL_TRIGGERS  where Trigger_name='TRG_PIR_IU_ITNFE_TIITNFENTRADA';


-- Chamado 379136 -- 29SET2023

SELECT * FROM PRODUTOS WHERE CODPROD LIKE 'I0931'

SELECT * FROM ORIGEM WHERE CODIGO LIKE '95'

SELECT * FROM PIR_CADASTRO_NDO_PRODUTO WHERE COD_PRODUTO LIKE 'I0931' -- TRÊS REGISTROS COM FINAIS 10, 19, 33, NDO: COM159, COD_PRODUTO = I0931
SELECT * FROM PIR_NDO_CFOP WHERE COD_NDO LIKE 'COM159'
SELECT * FROM NDO WHERE CODIGO IN ('COM159','COM086')
SELECT * FROM CFOP WHERE CODIGO LIKE '2551'
SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '%52374' -- Consta como recebida
SELECT * FROM PEDIDO_COMPRA WHERE VAL_TOTAL_PEDIDO > 92580 AND VAL_TOTAL_PEDIDO < 92581

SELECT * FROM PIR_AF_DOCUMENTO WHERE COD_AF LIKE '%52374'

--Buscando AFs que sejam equivalentes à AF 52374

SELECT NUMPEDC FROM ITENS_PED_COMPRA WHERE CODPROD IN (SELECT CODPROD FROM ITENS_PED_COMPRA WHERE NUMPEDC LIKE '%52374') -- Confirmado que só tem ela

-- 17OUT2023

SELECT * FROM BEM WHERE NUM_BEM = 111588

-- 02OUT2023

-- Almoxarifado, Produtos, Aplicação - NDO - Investimento/despesa

SELECT * FROM NDO WHERE CODIGO IN ('COM159','COM086','COM170')
SELECT * FROM PRODUTOS WHERE CODPROD LIKE 'I0931'

SELECT * FROM BEM WHERE CODPROD IS NOT NULL ORDER BY DAT_AQUISICAO DESC FETCH NEXT 2 ROWS ONLY

SELECT * FROM BEM WHERE CODPROD LIKE 'I6%'

SELECT * FROM PRODUTOS WHERE CODPROD LIKE 'S6756'

SELECT NUMPEDC FROM ITENS_PED_COMPRA WHERE CODPROD IN ('I6321','I6189','I6324','I6325','S6756','S6759')-- Confirmado que só tem ela, com todos os itens

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '%54427' OR NUMPEDC LIKE '%54428' --COM170

SELECT * FROM BEM FETCH FIRST 30 ROWS ONLY

SELECT NUM_BEM, DSC_BEM, QTD_NUMERO_ITENS FROM BEM WHERE NUM_BEM = 115893

-- Apresenta apenas os produtos com código iniciados em I

SELECT p.CODPROD, p.DESCRICAO, p.COD_GENERO, pgp.DSC_GENERO AS GENERO, o.DESCRICAO AS ORIGEM, ptp.DSC_TIPO_PATRIMONIO TIPO_PATRIMONIO, o.SIGLA FROM PRODUTOS p
INNER JOIN ORIGEM o ON o.CODIGO = p.COD_ORIGEM
INNER JOIN PIR_GENERO_PRODUTO pgp ON pgp.COD_GENERO = p.COD_GENERO
INNER JOIN PIR_TIPO_PATRIMONIO ptp ON ptp.COD_TIPO_PATRIMONIO = p.COD_TIPO_PATRIMONIO
WHERE p.CODPROD IN ('I6321','I6189','I6324','I6325','S6756','S6759')

-- Apresenta apenas os produtos com código iniciados em I

SELECT p.CODPROD, p.DESCRICAO, p.COD_GENERO, pgp.DSC_GENERO AS GENERO, o.DESCRICAO AS ORIGEM, o.SIGLA FROM PRODUTOS p
INNER JOIN ORIGEM o ON o.CODIGO = p.COD_ORIGEM
INNER JOIN PIR_GENERO_PRODUTO pgp ON pgp.COD_GENERO = p.COD_GENERO
WHERE p.CODPROD IN ('I6321','I6189','I6324','I6325','S6756','S6759')

SELECT * FROM PRODUTOS
WHERE CODPROD IN ('I6321','I6189','I6324','I6325','S6756','S6759') --IND_IMOBILIZAVEL = 0 para itens da NDO COM169

SELECT * FROM GRUPO_ALMOX FETCH NEXT 10 ROWS ONLY

SELECT * FROM NDO WHERE CODIGO IN ('COM087','COM169')

SELECT * FROM ORIGEM

------04/10/2023 -- prestação de contas

SELECT NUM_SEQ_PRESTCONTAS FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY

SELECT * FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH NEXT 20 ROWS ONLY

SELECT * FROM PIRAMIDE.PIR_CCUSTO_PRESTCONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH NEXT 20 ROWS ONLY

SELECT * FROM SEQUENCE.NUM_SEQ_PRESTCONTAS_AD

ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH 18974

----09OUT----

ALTER TRIGGER TRG_PIR_IU_ITNFE_TIITNFENTRADA ENABLE

--10OUT--

SELECT * FROM NFE WHERE NFE_NR_SERIE = 5 AND NFE_DT_EMISSAO > TO_DATE('21-08-23','DD-MM-YY') AND NFE_DT_EMISSAO < TO_DATE('01-09-23','DD-MM-YY')

SELECT * FROM NFE WHERE NFE_VL_PROD = 11214112,69
----------------------------------------------------------------------

------VIEW_CONTROLE_CORTES v1

SELECT text FROM all_views WHERE view_name = 'VIEW_FATU_DELOITE_VOLU_PROD'

SELECT * FROM CLIENTES WHERE NOME LIKE '%PETR%NUNE%' -- 32451886000186, 202301354

DROP VIEW VIEW_CONTROLE_CORTES

CREATE VIEW VIEW_CONTROLE_CORTES AS
select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ,
(CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO, t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM PIRAMIDE.TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIRAMIDE.PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIRAMIDE.PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join PIRAMIDE.CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN PIRAMIDE.ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN PIRAMIDE.TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN PIRAMIDE.ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE 
(t.status in ('A','P') AND t.VENCIMENTO <= (SYSDATE - 35)) -- Quinto requisito
AND CE.ATIVO = 'S' -- Primeiro Requisito
AND t.data_liq IS NULL
AND CG.DSC_ATRIBUTO IS NULL -- CHAMADO_GGAS_SUSPENSAO - Terceiro requisito
AND t.CLIENTE NOT LIKE 'F%'
AND (FC.DESCRICAO LIKE 'Residencial' OR FC.DESCRICAO LIKE 'Comercial') -- Quarto Requisito
AND (OB.DSC_ATRIBUTO IS NULL OR UPPER(OB.DSC_ATRIBUTO) NOT IN (
SELECT DSC_ATRIBUTO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC
WHERE UPPER(DSC_ATRIBUTO) LIKE '%MUDAN%TITUL%' OR UPPER(DSC_ATRIBUTO) LIKE '%MENTO%CONTRATO%' OR UPPER(DSC_ATRIBUTO) LIKE '%ONTRATO%CERRADO%'
							OR UPPER(DSC_ATRIBUTO) LIKE 'N_O%POS%VEL%SPENDER'
							OR UPPER(DSC_ATRIBUTO) LIKE '%G_S%SUSPENSO%'
							OR UPPER(DSC_ATRIBUTO) LIKE '%CJUR%'
							OR UPPER(DSC_ATRIBUTO) LIKE '%ENCAMIN%JUR_DIC%'
GROUP BY DSC_ATRIBUTO))


------VIEW_CONTROLE_CORTES v2 ---- VALIDADA COM A PLANILHA DE ANA

SELECT text FROM all_views WHERE view_name = 'VIEW_CONTROLE_CORTES'

DROP VIEW VIEW_CONTROLE_CORTES

CREATE VIEW VIEW_CONTROLE_CORTES AS
select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ,
(CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO, t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM PIRAMIDE.TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIRAMIDE.PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIRAMIDE.PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join PIRAMIDE.CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN PIRAMIDE.ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN PIRAMIDE.TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN PIRAMIDE.ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE 
(t.status in ('A','P') AND t.VENCIMENTO <= (SYSDATE - 35)) -- Quinto requisito
AND CE.ATIVO = 'S' -- Primeiro Requisito
AND t.data_liq IS NULL
AND CG.DSC_ATRIBUTO IS NULL -- CHAMADO_GGAS_SUSPENSAO - Terceiro requisito
AND t.CLIENTE NOT LIKE 'F%'
AND (FC.DESCRICAO LIKE 'Residencial' OR FC.DESCRICAO LIKE 'Comercial') -- Quarto requisito
AND ((OB.DSC_ATRIBUTO IS NOT NULL) OR (C.FANTASIA NOT LIKE '%*%'))
AND (UPPER(OB.DSC_ATRIBUTO) IN (
SELECT DSC_ATRIBUTO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC 
WHERE UPPER(DSC_ATRIBUTO) LIKE '%FATURAS EM ABERT%' OR UPPER(DSC_ATRIBUTO) LIKE '%O PERMITE AC%' GROUP BY DSC_ATRIBUTO) OR OB.DSC_ATRIBUTO IS NULL) -- Segundo requisito


OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'




SELECT * FROM VIEW_CONTROLE_CORTES

SELECT * FROM PIRAMIDE.TITULO_REC

DROP VIEW IGORM.VIEW_CONTROLE_CORTES 


SELECT * FROM TITULO_REC ORDER BY CLIENTE DESC

--CHAMADO S916017

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '00053955'
SELECT * FROM PEDIDO_COMPRA WHERE FORNECEDOR LIKE '5919' OR FORNECEDOR LIKE '5918'

SELECT * FROM ENTRADA WHERE FORNECEDOR LIKE '5919'

SELECT * FROM FORNEC_EMPRESA WHERE FORNEC LIKE '4812' OR FORNEC LIKE '5919' -- Tem o registro

-- Para se registrar um PEDIDO_COMPRA, precisa: FILIAL, NUMPEDC (automático), EMPRESA, COMPRADOR, FORNECEDOR, CONDICAO, CONTATO, DT_PEDIDO, SEQITEM, STATUS (A), ORIGEM, COD_AF_MAE
   
-- Faz referência à tabela FORNEC_CONTA. Pode ser uma das colunas EMPRESA, FORNECEDOR or COD_FNT_RECURSO

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'PRE 031.23' --

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_FREQUENCIA_PAGAMENTO LIKE 'I'

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'PRE 031.23'

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_FORNECEDOR LIKE '5919' OR COD_FORNECEDOR LIKE '5918' OR COD_FORNECEDOR LIKE '5920'

-- COD_CONTRATO: PRE 031.23
-- COD_TIPO_CONTRATO: 017, PIR_TIPO_CONTRATO
-- COD_CCUSTO_PADRAO: 1.01.0003, CUSTO
-- COD_CONDICAO_PAGAMENTO: 15, CONDICAO

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CCUSTO_PADRAO LIKE '1.01.0003'

SELECT * FROM PIR_TIPO_CONTRATO WHERE COD_TIPO_CONTRATO = 017

SELECT a.table_name, a.column_name, a.constraint_name, c.owner, 
       c.r_owner, c_pk.table_name r_table_name, c_pk.constraint_name r_pk
  FROM all_cons_columns a
  JOIN all_constraints c ON a.owner = c.owner
                        AND a.constraint_name = c.constraint_name
  JOIN all_constraints c_pk ON c.r_owner = c_pk.owner
                           AND c.r_constraint_name = c_pk.constraint_name
 WHERE c.constraint_type = 'R'
   AND a.table_name = 'PEDIDO_COMPRA'
   
SELECT * FROM CFOP WHERE CODIGO LIKE '1949'

SELECT * FROM FORNEC_EMPRESA
   
SELECT fc.*, pcp.COD_CONTRATO  FROM FORNEC_CONTA fc
INNER JOIN FORNEC_EMPRESA fe ON fc.COD_EMP_CNT = fe.EMPRESA
INNER JOIN FORNEC_EMPRESA fe ON fc.COD_EMP_CNT = fe.EMPRESA
INNER JOIN PIR_CONTRATO_PASSIVO pcp ON fc.COD_FOR_CNT = pcp.COD_FORNECEDOR
WHERE pcp.COD_CONTRATO LIKE 'PRE 031.23'

-- COD_FOR_CNT = 5919, COD_EMP_CNT = 001, COD_FNT_REC = 99

-- 22SET2023 Pagamento dia 28

SELECT * FROM PEDIDO_COMPRA WHERE FORNECEDOR LIKE '5919' --SEM AFs. Será a primeira (provavelmente única) AF

ORA-02291: integrity CONSTRAINT (PIRAMIDE.FK_FORCNT_PEDCMP) violated - parent KEY NOT FOUND

SELECT * FROM NFE_FATURA

SELECT * FROM PIR_FATURAS FETCH FIRST 10 ROWS ONLY

SELECT * FROM PEDIDO_COMPRA pc
INNER JOIN FORNEC_CONTA fc ON fc.COD_FOR_CNT = pc.FORNECEDOR
WHERE fc.COD_FNT_REC LIKE '99'

SELECT a.table_name, a.column_name, a.constraint_name, c.owner, 
       -- referenced pk
       c.r_owner, c_pk.table_name r_table_name, c_pk.constraint_name r_pk
  FROM all_cons_columns a
  JOIN all_constraints c ON a.owner = c.owner
                        AND a.constraint_name = c.constraint_name
  JOIN all_constraints c_pk ON c.r_owner = c_pk.owner
                           AND c.r_constraint_name = c_pk.constraint_name
 WHERE c.constraint_type = 'R'
   AND a.table_name = 'FORNEC_CONTA' --EMPRESA, FORNECEDOR, COD_FNT_RECURSO, PK_FORNEC_CONTA

SELECT * FROM FORNEC_CONTA WHERE COD_FOR_CNT LIKE '5919' -- NUM_BANCO: 401, NUM_AGENCIA: 00001, NUM_CCORRENTE: 0070702660

SELECT * FROM PORT_EMPRESA_CC WHERE PORTADOR LIKE '401'

SELECT * FROM AGENCIA

SELECT * FROM FORNEC_CONTA WHERE COD_FNT_REC LIKE '99' -- NUM_BANCO: 401, NUM_AGENCIA: 00001, NUM_CCORRENTE: 0070702660

SELECT * FROM CCORRENTE WHERE FORNEC LIKE '4812' --Ex

SELECT * FROM FONTE_RECURSO WHERE COD_FNT_REC LIKE '401'

SELECT * FROM PORTADOR WHERE PORTADOR LIKE '401' OR PORTADOR LIKE '341' OR PORTADOR LIKE '237' OR PORTADOR LIKE '004' -- PORTADOR = 401, NOME = IUGU IP SA

SELECT * FROM PIRAMIDE.FORNEC WHERE CODIGO LIKE '5918' OR CODIGO LIKE '5919' OR CODIGO LIKE '5920' --Ex

SELECT * FROM PIRAMIDE.PIR_FORNEC_CONTAS  WHERE COD_FORNEC LIKE '5919' OR COD_FORNEC LIKE '5920' OR COD_FORNEC LIKE '5916' --Ex

SELECT * FROM FORNEC_EMPRESA WHERE FORNEC LIKE '5919' OR  FORNEC LIKE '5916' OR FORNEC LIKE '5918'


select
   pk.owner         pk_owner,
   pk.table_name    pk_table,
   fk.owner         fk_owner,
   fk.table_name    fk_table, 
   pk.status        pk_status,
   fk.status        fk_status
from
   all_constraints  pk                                                     join
   all_constraints  fk on pk.owner           = fk.r_owner            and
                          pk.constraint_name = fk.r_constraint_name
where
   fk.owner || '.' || fk.constraint_name = 'PIRAMIDE.FK_FORCNT_PEDCMP'


--

SELECT * FROM PIRAMIDE.FORNEC WHERE CODIGO LIKE '5919'

SELECT * FROM PIRAMIDE.FORNEC WHERE

--CHAMADO   25/09/2023

SELECT * FROM PIRAMIDE.FORNEC WHERE CGC LIKE '14766411000105'

SELECT table_name FROM all_tab_columns WHERE column_name = 'COD_STATUS_NFEL'

---
   
--CHAMADO S908688 - 20/09/2023

SELECT NUMPEDC, COD_AF_MAE FROM PEDIDO_COMPRA WHERE NUMPEDC = 53917 OR COD_AF_MAE = 53917
SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC = 53917 -- val_total_pedido = 1429, FILIAL = 001, FORNECEDOR 4812
SELECT * FROM FORNEC_EMPRESA WHERE FORNEC LIKE '4812'
SELECT * FROM FORNEC WHERE CODIGO LIKE '4812'

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '00053955'


--TABELAS COM COLUNA COD_AF

SELECT table_name FROM all_tab_columns WHERE column_name = 'NUMPEDC'

SELECT * FROM VIEW_CONTRATOS_BI_GETI WHERE CONTRATO LIKE 'DTC 016.21' --Nada
SELECT * FROM VIEW_CONTRATOS_BI_GETI WHERE NUMPEDC LIKE '%53917' --Nada

SELECT * FROM PIR_ITEM_SOLICITACAO_VIAGEM WHERE COD_AF = 53917 --DOIS REGISTROS

SELECT * FROM VW_AUTORIZACAO_AF WHERE NUMPEDC LIKE '%53917' --1429

SELECT * FROM ITENS_PED_COMPRA WHERE NUMPEDC = 53917 -- PRECO_PEDIDO 1429 COD_CONTRATO_TERC = DAF 039.22

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DTC 016.21' AND COD_PRODUTO LIKE 'SER295' -- DOIS REGISTROS
--COD_PRODUTO SER296 (PASSAGEM PARA TREINAMENTO) SER293 (PASSAGEM PARA REPRESENTAÇÃO)

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DAF 046.17' --Contrato para serviços de reserva, emissão e entrega de bilhetes aéreos para viagens, COD_FORNECEDOR = 4812

SELECT * FROM CONTRATOS

SELECT * FROM APLICACAO WHERE CODAPLICA LIKE 'SER%'

SELECT * FROM TITULO_PAG WHERE FORNEC LIKE '4812' AND OBSERVACAO LIKE '%PASSAGENS%' ORDER BY LANCAMENTO DESC -- OU TÍTULO FT00157282/S01.01 (PROVÁVEL) OU 00158460/S01.01

----------------------------------------------------------------------------------------------

SELECT ORIGEM FROM VIEW_CONTROLE_INADIMPLENCIA WHERE MATRICULA IS NULL GROUP BY ORIGEM

SELECT ORIGEM FROM VIEW_CONTROLE_INADIMPLENCIA WHERE ORIGEM IN (SELECT ORIGEM FROM VIEW_CONTROLE_INADIMPLENCIA WHERE MATRICULA IS NULL GROUP BY ORIGEM) AND MATRICULA IS NOT NULL GROUP BY ORIGEM



SELECT * FROM VIEW_CONTROLE_INADIMPLENCIA2

SELECT * FROM PIRAMIDE.CLIENTES WHERE CODIGO = '8033'

select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ, C.COD_CONTRATO AS MATRICULA, t.TITULO, t.CODDOC AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO , t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO
       FROM TITULO_REC t
--UNIÃO COM AVISO DE DEBITO
left join PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
INNER JOIN CLIENTES C ON t.CLIENTE = C.CODIGO


SELECT * FROM TITULO_REC
SELECT * FROM CLIENTES

SELECT ce.CLIENTE, ce.EMPRESA, e.NOME FROM CLIENTE_EMPRESA ce
LEFT JOIN EMPRESA e ON e.EMPRESA = ce.EMPRESA
LEFT JOIN CLIENTES c ON c.CODIGO = ce.CLIENTE 
WHERE CLIENTE = '8033'

SELECT * FROM EMPRESA

SELECT t.CLIENTE, C.NOMEFROM  TITULO_REC t
INNER JOIN CLIENTES C ON t.CLIENTE = C.CODIGO

SELECT table_name FROM all_tab_columns WHERE column_name = 'COD_AF'


SELECT text FROM all_views WHERE view_name = 'VIEW_ORCAMENTO_CONTA_SESUITE' -> Usa dados de outras VIEWS
piramide.vw_sinc_inadimp_app_ung => copergas.VW_SINC_DADOS_INADIMPLENCIA@DBL_PIR_UNG  -> DBLINK -> Poucos clientes, não vale a pena
view_analise_inadimp_app_ggas => VW_DADOS_INADIMPLENCIA2@DBL_PIR_GGAS

SELECT text FROM all_views WHERE view_name = 'VW_DADOS_INADIMPLENCIA' -> Base do GGAS
Concluído que puxa da tabela CONTRATO_PONTO_CONS_EMAIL_COBR, campo coec_ds_email




SELECT * FROM copergas.VW_SINC_DADOS_INADIMPLENCIA@DBL_PIR_UNG (DBLINK PARA UNIGAS)


-- Propósito geral da planilha

-- Duas views: corte e religamento

SELECT (CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
 DA.*
FROM PIRAMIDE.TITULO_REC t
LEFT JOIN PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO

select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ,
(CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO , t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM PIRAMIDE.TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIRAMIDE.PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIRAMIDE.PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join PIRAMIDE.CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN PIRAMIDE.ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN PIRAMIDE.TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN PIRAMIDE.ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE (
(t.status in ('A','P') AND t.VENCIMENTO < SYSDATE)
  OR (t.status IN ('L','EL') 
    AND (
      (CG.DSC_ATRIBUTO IS NOT NULL AND CGR.DSC_ATRIBUTO IS NULL) -- OBSERVAÇÃO, CHAMADO_GGAS_RELIGAMENTO
      OR 
      ((DNDT.DSC_ATRIBUTO IS NOT NULL OR DN.DSC_ATRIBUTO IS NOT NULL) AND RETNEG.DSC_ATRIBUTO IS NULL) -- DATA_NEGATIVACAO, NEGATIVAÇÃO, DATA_RETIRADA_NEGATIVA
    )
  )
)
--AND t.CLIENTE = '8033'
--AND DNDT.DSC_ATRIBUTO IS NULL
AND CE.ATIVO = 'S'
AND CG.DSC_ATRIBUTO IS NULL
AND t.CLIENTE NOT LIKE 'F%'
AND OB.DSC_ATRIBUTO NOT IN (
SELECT DSC_ATRIBUTO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC
WHERE UPPER(DSC_ATRIBUTO) LIKE 'MUD%TITUL%' OR UPPER(DSC_ATRIBUTO) LIKE '%MENTO%CONTRATO%' OR UPPER(DSC_ATRIBUTO) LIKE '%ONTRATO%CERRADO%' OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE 'NÃO%POS%VEL%SPENDER'
GROUP BY DSC_ATRIBUTO)



--F é fornecedor

SELECT * FROM TI_CLIENTE
WHERE COD_CLIENTE_DESTINO = 'F4404'

SELECT COD_CONTRATO_ORIGEM FROM TI_CLIENTE
WHERE COD_CLIENTE_DESTINO = '8033'
AND COD_CONTRATO_ORIGEM IS NOT NULL
AND rownum = 1

SELECT * FROM CLIENTES WHERE CODIGO = 17627

-- Há 3467 registros na nova view e 14063 na antiga
-- 10706 registros travados

-- Query atualizada para suspensão de fornecimento

----------------------- TIPO_DOCUMENTO = 'CJUR' DEVE ELIMINAR

-- Todos os critérios estão satisfeitos, no entando ainda há registros com pelo menos um dos campos AVISO_DEBITO ou AVISO_SUSPENSAO constando como NULL. Verificar se deve antes se enviado e-mail de aviso

SELECT * FROM IGORM.VIEW_CONTROLE_CORTES

SELECT pp.CODPROD, pp.DESCRICAO, pp.COD_ORIGEM, po.DESCRICAO AS ORIGEM, pp.DT_CADASTRO, pp.COD_TIPO_PATRIMONIO, ptp.DSC_TIPO_PATRIMONIO  FROM PIRAMIDE.PRODUTOS pp
LEFT JOIN PIRAMIDE.PIR_TIPO_PATRIMONIO ptp ON ptp.COD_TIPO_PATRIMONIO = pp.COD_TIPO_PATRIMONIO
LEFT JOIN PIRAMIDE.ORIGEM po ON po.CODIGO = pp.COD_ORIGEM

SELECT table_name FROM all_tab_columns WHERE column_name = 'EMAIL'

SELECT p.CODIGO, p.COD_CATEGORIA_PESSOA, p.EMAIL AS EMAIL_PESSOA, pc.EMAIL AS EMAIL_CLIENTES FROM PIRAMIDE.PESSOA p
LEFT JOIN PIRAMIDE.CLIENTES pc ON pc.NOME = p.NOME
WHERE pc.EMAIL <> p.EMAIL

DROP VIEW VIEW_CONTROLE_CORTES

SELECT * FROM VIEW_CONTROLE_CORTES

CREATE VIEW VIEW_CONTROLE_CORTES AS
select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ,
(CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO, t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM PIRAMIDE.TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIRAMIDE.PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIRAMIDE.PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join PIRAMIDE.CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN PIRAMIDE.ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN PIRAMIDE.TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN PIRAMIDE.ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE 
(t.status in ('A','P') AND t.VENCIMENTO <= (SYSDATE - 35))
--AND DNDT.DSC_ATRIBUTO IS NULL
--AND tpo.DSC_ATRIBUTO NOT LIKE 'CJUR'
AND CE.ATIVO = 'S'
AND CG.DSC_ATRIBUTO IS NULL
AND t.CLIENTE NOT LIKE 'F%'
--AND t.CLIENTE = '4449'
AND t.data_liq IS NULL
AND OB.DSC_ATRIBUTO NOT IN (
SELECT DSC_ATRIBUTO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC
WHERE UPPER(DSC_ATRIBUTO) LIKE '%MUD%TITUL%' OR UPPER(DSC_ATRIBUTO) LIKE '%MENTO%CONTRATO%' OR UPPER(DSC_ATRIBUTO) LIKE '%ONTRATO%CERRADO%'
							OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE 'N_O%POS%VEL%SPENDER'
							OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE '%G_S%SUSPENSO%'
							OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE '%CJUR%'
							OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE '%ENCAMIN%JUR_DIC%'
GROUP BY DSC_ATRIBUTO)

SELECT NUM_TITULO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC WHERE (DSC_ATRIBUTO NOT LIKE 'CJUR') ORDER BY NUM_TITULO LIMIT 2;

SELECT COUNT(*) FROM PIRAMIDE.VIEW_CONTROLE_INADIMPLENCIA --16144

SELECT * FROM IGORM.VIEW_CONTROLE_INADIMPLENCIA2 WHERE TITULO LIKE '%GAS%' --15115 695233.GAS



SELECT text FROM all_views WHERE view_name = 'VIEW_CONTROLE_INADIMPLENCIA'

SELECT text FROM all_source WHERE name = 'ENVIA_EMAIL_CPG_INTERNO';

SELECT * FROM PIRAMIDE.TITULO_REC WHERE TITULO LIKE '695233.GAS'

--------- VRF

select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ,
(CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO , t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM PIRAMIDE.TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIRAMIDE.PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIRAMIDE.PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join PIRAMIDE.CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN PIRAMIDE.ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN PIRAMIDE.TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN PIRAMIDE.ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE (
(t.status in ('A','P') AND t.VENCIMENTO < SYSDATE)
  OR (t.status IN ('L','EL') 
    AND (
      (CG.DSC_ATRIBUTO IS NOT NULL AND CGR.DSC_ATRIBUTO IS NULL) -- OBSERVAÇÃO, CHAMADO_GGAS_RELIGAMENTO
      OR 
      ((DNDT.DSC_ATRIBUTO IS NOT NULL OR DN.DSC_ATRIBUTO IS NOT NULL) AND RETNEG.DSC_ATRIBUTO IS NULL) -- DATA_NEGATIVACAO, NEGATIVAÇÃO, DATA_RETIRADA_NEGATIVA
    )
  )
)
--AND t.CLIENTE = '8033'
--AND DNDT.DSC_ATRIBUTO IS NULL
AND CE.ATIVO = 'S'
AND CG.DSC_ATRIBUTO IS NULL
AND t.CLIENTE NOT LIKE 'F%'
AND OB.DSC_ATRIBUTO NOT IN (
SELECT DSC_ATRIBUTO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC
WHERE UPPER(DSC_ATRIBUTO) LIKE 'MUD%TITUL%' OR UPPER(DSC_ATRIBUTO) LIKE '%MENTO%CONTRATO%' OR UPPER(DSC_ATRIBUTO) LIKE '%ONTRATO%CERRADO%' OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE 'NÃO%POS%VEL%SPENDER'
GROUP BY DSC_ATRIBUTO)

--Query na planilha dinâmica de Ana Gambôa

SELECT vw_pir.*, vw_ggas."GGAS_EMAILS_CONTRATO", vw_ggas."GGAS_EMAIL_CLIENTE_PRINCIPAL"
FROM IGORM.VIEW_CONTROLE_INADIMPLENCIA2 vw_pir
LEFT JOIN VW_INADIMPL_CLIENTES_CONTRATO@DBL_PIR_GGAS vw_ggas 
ON vw_pir.MATRICULA = vw_ggas."GGAS_NUMERO_CONTRATO"

------------------------ Query original da VIEW_CONTROLE_INADIMPLENCIA

select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ, C.COD_CONTRATO AS MATRICULA, 
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO , t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE (
(t.status in ('A','P') AND t.VENCIMENTO < SYSDATE)
  OR (t.status IN ('L','EL') 
    AND (
      (CG.DSC_ATRIBUTO IS NOT NULL AND CGR.DSC_ATRIBUTO IS NULL) 
      OR 
      ((DNDT.DSC_ATRIBUTO IS NOT NULL OR DN.DSC_ATRIBUTO IS NOT NULL) AND RETNEG.DSC_ATRIBUTO IS NULL)
    )
  )
)
 
--AND CE.ATIVO = 'S'

SELECT * FROM VIEW_CONTROLE_INADIMPLENCIA 

SELECT vw_pir.*, vw_ggas."GGAS_EMAILS_CONTRATO", vw_ggas."GGAS_EMAIL_CLIENTE_PRINCIPAL"
FROM VIEW_CONTROLE_INADIMPLENCIA vw_pir
LEFT JOIN VW_INADIMPL_CLIENTES_CONTRATO@DBL_PIR_GGAS vw_ggas 
ON vw_pir.MATRICULA = vw_ggas."GGAS_NUMERO_CONTRATO"
WHERE vw_pir.MATRICULA LIKE '41027'

SELECT * FROM VW_INADIMPL_CLIENTES_CONTRATO@DBL_PIR_GGAS vw_ggas 

select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ,
(CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO , t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM PIRAMIDE.TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIRAMIDE.PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIRAMIDE.PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join PIRAMIDE.CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN PIRAMIDE.ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN PIRAMIDE.TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN PIRAMIDE.ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE (
(t.status in ('A','P') AND t.VENCIMENTO < SYSDATE)
  OR (t.status IN ('L','EL') 
    AND (
      (CG.DSC_ATRIBUTO IS NOT NULL AND CGR.DSC_ATRIBUTO IS NULL) -- OBSERVAÇÃO, CHAMADO_GGAS_RELIGAMENTO
      OR 
      ((DNDT.DSC_ATRIBUTO IS NOT NULL OR DN.DSC_ATRIBUTO IS NOT NULL) AND RETNEG.DSC_ATRIBUTO IS NULL) -- DATA_NEGATIVACAO, NEGATIVAÇÃO, DATA_RETIRADA_NEGATIVA
    )
  )
)
--AND DNDT.DSC_ATRIBUTO IS NULL
AND CE.ATIVO = 'S'
--AND CG.DSC_ATRIBUTO IS NULL
--AND t.CLIENTE NOT LIKE 'F%'
--AND OB.DSC_ATRIBUTO NOT IN (
--SELECT DSC_ATRIBUTO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC
--WHERE UPPER(DSC_ATRIBUTO) LIKE 'MUD%TITUL%' OR UPPER(DSC_ATRIBUTO) LIKE '%MENTO%CONTRATO%' OR UPPER(DSC_ATRIBUTO) LIKE '%ONTRATO%CERRADO%' OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE 'NÃO%POS%VEL%SPENDER'
--GROUP BY DSC_ATRIBUTO)

select distinct f.codigo, f.NOME, f.FANTASIA, f.CGC AS CNPJ_CPF, f.INSCRICAO, f.BAIRRO, f.CIDADE, f.COD AS CEP, f.ENDERECO, f.EMAIL, f.FONE, f.PESSOA, --f.DAT_CAD, CASE WHEN e.dt_entrada IS NULL THEN TO_CHAR('SEM NOTA') ELSE to_char(e.dt_entrada) end as DATA_ULTIMA_NF_ENTRADA from fornec f left join entrada e on f.codigo = e.fornecedor where ((e.dt_entrada is null) or (e.dt_entrada is not null and e.dt_entrada = (select max(ef.dt_entrada) from entrada ef where ef.fornecedor = e.fornecedor)))







select t.CLIENTE, C.NOME, C.CGC AS CPF_CNPJ,
(CASE WHEN (C.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
FC.DESCRICAO AS SEGMENTO, T.TITULO, TI.COD_NF AS NOTA_FISCAL, t.CODDOC, O.DESCRICAO AS ORIGEM, 
t.EMISSAO, t.VENCIMENTO, t.STATUS, t.data_liq as DATA_LIQUIDAÇÃO , t.VALOR,
       DA.DSC_ATRIBUTO AS AVISO_DEBITO, 
       ASU.DSC_ATRIBUTO AS AVISO_SUSPENSAO,
       (CASE WHEN (CG.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN '0000000000'
       ELSE CG.DSC_ATRIBUTO END) AS CHAMADO_GGAS_SUSPENSAO, 
       CGR.DSC_ATRIBUTO AS CHAMADO_GGAS_RELIGAMENTO,
       DN.DSC_ATRIBUTO AS NEGATIVACAO,
       AEJ.DSC_ATRIBUTO AS NOTIFICACAO_EXTRA_JUDICIAL, 
       (CASE WHEN (OB.DSC_ATRIBUTO IS NULL AND C.FANTASIA LIKE '%*%') THEN 'MUDANÇA DE TITULARIDADE'
       ELSE OB.DSC_ATRIBUTO END) AS OBSERVACAO,
       tpo.DSC_ATRIBUTO AS TIPO_DOCUMENTO,
       DNDT.DSC_ATRIBUTO AS DATA_NEGATIVACAO,
       RETNEG.DSC_ATRIBUTO AS DATA_RETIRADA_NEG,
       CE.ATIVO
       FROM PIRAMIDE.TITULO_REC t 
--UNIÃO COM AVISO DE DEBITO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DA on t.TITULO = DA.NUM_TITULO AND DA.COD_TIPO_ATRIBUTO = 'DT_AVDEB'
--UNIÃO COM AVISO DE SUSPENSÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC ASU on t.TITULO = ASU.NUM_TITULO AND ASU.COD_TIPO_ATRIBUTO = 'DT_AVSUS'
--UNIÃO COM CHAMADO GGAS SUSPENSAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CG on T.TITULO = CG.NUM_TITULO AND CG.COD_TIPO_ATRIBUTO = 'CHA_GGAS'
--UNIÃO COM CHAMADO GGAS RELIGAMENTO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC CGR on T.TITULO = CGR.NUM_TITULO AND CGR.COD_TIPO_ATRIBUTO = 'CH_RELIG'
--UNIAO COM DATA NEGATIVAÇÃO_SN
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DN on t.TITULO = DN.NUM_TITULO AND DN.COD_TIPO_ATRIBUTO = 'DT_NEGA'
--UNIAO COM DATA NEGATIVAÇÃO_DT
left join PIRAMIDE.PIR_ATRIBUTO_TITREC DNDT on t.TITULO = DNDT.NUM_TITULO AND DNDT.COD_TIPO_ATRIBUTO = 'DT_NEGA2'
--UNIAO COM DATA RETIRADA DA NEGATIVAÇÃO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC RETNEG on t.TITULO = RETNEG.NUM_TITULO AND RETNEG.COD_TIPO_ATRIBUTO = 'DT_RTNEG'
--UNIAO COM DATA AVISO EXTRA JUDICIAL
left join PIRAMIDE.PIR_ATRIBUTO_TITREC AEJ on t.TITULO = AEJ.NUM_TITULO AND AEJ.COD_TIPO_ATRIBUTO = 'DT_NOTEX'
--UNIÃO COM OBSERVACAO
left join PIRAMIDE.PIR_ATRIBUTO_TITREC OB on t.TITULO = OB.NUM_TITULO AND OB.COD_TIPO_ATRIBUTO = 'OBSERVAC'
--UNIÃO COM tipodoc
left join PIRAMIDE.PIR_ATRIBUTO_TITREC tpo on t.TITULO = tpo.NUM_TITULO AND tpo.COD_TIPO_ATRIBUTO = 'tipodoc'
INNER JOIN PIRAMIDE.CLIENTES C ON t.CLIENTE = C.CODIGO
--UNIÃO COM CLIENTE EMPRESA PARA FILTRAR APENAS OS ATIVOS NO PIRÂMIDE
left join PIRAMIDE.CLIENTE_EMPRESA CE ON CE.CLIENTE = C.CODIGO
INNER JOIN PIRAMIDE.ORIGEM O ON t.ORIGEM = O.CODIGO
LEFT JOIN PIRAMIDE.TI_DOCUMENTO_REC TI ON t.TITULO = TI.COD_DOCUMENTO_ORIGEM
INNER JOIN PIRAMIDE.ITEM_FCAIXA FC ON t.COD_ITEM_FC_TREC = FC.CODIGO_ITEM
WHERE (
(t.status in ('A','P') AND t.VENCIMENTO < SYSDATE)
  OR (t.status IN ('L','EL') 
    AND (
      (CG.DSC_ATRIBUTO IS NOT NULL AND CGR.DSC_ATRIBUTO IS NULL) -- OBSERVAÇÃO, CHAMADO_GGAS_RELIGAMENTO
      OR 
      ((DNDT.DSC_ATRIBUTO IS NOT NULL OR DN.DSC_ATRIBUTO IS NOT NULL) AND RETNEG.DSC_ATRIBUTO IS NULL) -- DATA_NEGATIVACAO, NEGATIVAÇÃO, DATA_RETIRADA_NEGATIVA
    )
  )
)
--AND DNDT.DSC_ATRIBUTO IS NULL
AND CE.ATIVO = 'S'
--AND CG.DSC_ATRIBUTO IS NULL
--AND t.CLIENTE NOT LIKE 'F%'
--AND OB.DSC_ATRIBUTO NOT IN (
--SELECT DSC_ATRIBUTO FROM PIRAMIDE.PIR_ATRIBUTO_TITREC
--WHERE UPPER(DSC_ATRIBUTO) LIKE 'MUD%TITUL%' OR UPPER(DSC_ATRIBUTO) LIKE '%MENTO%CONTRATO%' OR UPPER(DSC_ATRIBUTO) LIKE '%ONTRATO%CERRADO%' OR DSC_ATRIBUTO IS NULL OR UPPER(DSC_ATRIBUTO) LIKE 'NÃO%POS%VEL%SPENDER'
--GROUP BY DSC_ATRIBUTO)

SELECT * FROM titulo_rec WHERE titulo LIKE '153374.S1'

SELECT * FROM titulo_rec WHERE CLIENTE LIKE '207' AND STATUS = 'A'

SELECT * FROM CLIENTES WHERE codigo LIKE '8354'

SELECT * FROM CLIENTES WHERE NOME LIKE 'L%M%INDUSTRIAS%LTDA'

SELECT ATIVO FROM PIRAMIDE.CLIENTE_EMPRESA WHERE CLIENTE LIKE '207'


SELECT * FROM USUARIO ORDER BY NOM_USUARIO_LOGIN 
SELECT * FROM PERFIL p

select
   blocking_session,
   username,
   sid,
   serial#,
   wait_class,
   seconds_in_wait
from
   v$session
where
   blocking_session is not NULL
order by
   blocking_session;
  
ALTER SYSTEM KILL SESSION '1936, 46105' -- Mata blocking sessions



SELECT 
c.CGC,
c.NOME,
tr.TITULO,
tr.VALOR,
tr.emissao,
tr.vencimento,
tr.data_liq,
tr.STATUS
FROM TITULO_REC tr
INNER JOIN CLIENTES c ON c.CODIGO = tr.CLIENTE
WHERE tr.titulo IN ('RENMFTEIXEIRA2',

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DAF 046.17'

UPDATE PIR_CONTRATO_PASSIVO
SET COD_STATUS = 'A' --ATUALMENTE ESTÁ "EN"
WHERE COD_CONTRATO LIKE 'DAF 046.17'

SELECT * FROM TITULO_REC WHERE TITULO LIKE '261902.S1'

UPDATE TITULO_REC
SET STATUS = 'C'
WHERE TITULO LIKE '261902.S1'

SELECT * FROM piramide.vw_sinc_inadimp_app_ung WHERE TITULO LIKE '261902.S1' -- Continua em aberto NO Unigás conforme VIEW

SELECT * FROM TITULO_REC WHERE STATUS LIKE 'C' AND TITULO LIKE '%.S1'


--20OUTUBRO

-- Alteração para refletir objeto de contrato correto

SELECT * FROM FORNEC_EMPRESA WHERE FORNEC LIKE '4812'

-- Para se registrar um PEDIDO_COMPRA, precisa: FILIAL, NUMPEDC (automático), EMPRESA, COMPRADOR, FORNECEDOR, CONDICAO, CONTATO, DT_PEDIDO, SEQITEM, STATUS (A), ORIGEM, COD_AF_MAE
   
-- Faz referência à tabela FORNEC_CONTA. Pode ser uma das colunas EMPRESA, FORNECEDOR or COD_FNT_RECURSO

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '%53873'

SELECT * FROM ITENS_PED_COMPRA WHERE NUMPEDC LIKE '%53873' -- "Reunião de Apresentação do PPN 2024-2029 na sede da Commit Gás."

UPDATE ITENS_PED_COMPRA SET CODPROD = 'SER293' WHERE NUMPEDC LIKE '%53873' -- Estava SER295

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DAF 039.22' -- PASSAGEM PARA REPRESENTAÇÃO SER293 PASSAGEM PARA TREINAMENTO - SER296

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_FORNECEDOR LIKE '4812' -- CONTRATO DAF 039.22

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_FORNECEDOR LIKE '5919' OR COD_FORNECEDOR LIKE '5918' OR COD_FORNECEDOR LIKE '5920'

-- Erro na liquidação por encontro de contas

SELECT * FROM TITULO_REC WHERE TITULO LIKE 'ND GFIN 002/2013%'

SELECT * FROM TITULO_REC WHERE CLIENTE LIKE 189


SELECT * FROM DEPOSITO_EMPRESA ORDER BY SIGLA

SELECT * FROM DEPOSITO

-- Pesquisa Bens/desaglutinação de bens

-- Almoxarifado, Produtos, Aplicação - NDO - Investimento/despesa

SELECT * FROM NDO WHERE CODIGO IN ('COM159','COM086','COM170')
SELECT * FROM PRODUTOS WHERE CODPROD LIKE 'I0931'

SELECT * FROM BEM WHERE CODPROD IS NOT NULL ORDER BY DAT_AQUISICAO DESC FETCH NEXT 2 ROWS ONLY

SELECT * FROM BEM WHERE CODPROD LIKE 'I6%'

SELECT * FROM PRODUTOS WHERE CODPROD LIKE 'S6756'

SELECT NUMPEDC FROM ITENS_PED_COMPRA WHERE CODPROD IN ('I6321','I6189','I6324','I6325','S6756','S6759')-- Confirmado que só tem ela, com todos os itens

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '%54427' OR NUMPEDC LIKE '%54428' --COM170

SELECT * FROM BEM FETCH FIRST 30 ROWS ONLY

SELECT NUM_BEM, DSC_BEM, QTD_NUMERO_ITENS FROM BEM WHERE NUM_BEM = 115893

SELECT * FROM PIR_SCO_CNTAUX_PLNCNT WHERE COD_ITEM_CNTAUX LIKE '15670'

-- Conta auxiliar

SELECT * FROM CONTA_AUX 
SELECT * FROM CNT_CNTAUX WHERE CONTA LIKE '1.1.2.1.01.001'

SELECT * FROM ITEM_CNTAUX WHERE ITEM_CNTAUX LIKE '15673'

SELECT * FROM ITEM_CNTAUX_HIST

SELECT * FROM PIR_TRECNDO_LANC_PRORATA WHERE COD_ITEM_CNTAUX LIKE '15665'

SELECT * FROM PIR_LOCALIZACAO_CONTAS WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_VENDEDOR_CONTAS_FILIAL WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_AGENCIA_COBRANCA_CONTAS WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_VENDEDOR_CONTAS WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_SCO_ORCAMENTO_CNTAUX WHERE COD_ITEM_CNT_AUX LIKE '15665'
SELECT * FROM GERENCIAL_CONF WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_SALDOS_CONTABILIDADE WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PEDIDO_COMPRA WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM SOLICITACAO_COMPRA WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM CONFIGURACAO WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PARAMETRO_RATEIO_CCUSTO WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_FAT_ITENS_CONTRATO_CONF WHERE COD_ITEM_CONTA_AUXILIAR LIKE '15665'
SELECT * FROM PIR_CONTA_AVISO_PRODUCAO WHERE ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_SCO_CNTAUX_PLNCNT WHERE COD_ITEM_CNTAUX LIKE '15665'

SELECT * FROM ITEM_CNTAUX_HIST WHERE COD_ITEM_CNT_AUX LIKE '15665' -- Vazia
SELECT * FROM PIR_PORTCC_CONTAS WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_ITEM_PEDIDO_CONF WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_ITEM_CNTAUX_FILIAL WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_ITEMCT_CONF WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_CLIENTE_CONTAS WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM DOC_VAR_MONETARIA WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_ITEM_ENTRADA_CONF WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_ITENS_CUPFIS_CONF WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_FORNEC_CONTAS WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM MOV_PATRIMONIAL WHERE COD_ITEM_CNT_AUX LIKE '15665'
SELECT * FROM PIR_CNTAUX_DESP_PRESTCONTAS WHERE COD_ITEM_CNT_AUX LIKE '15665' -- Vazia
SELECT * FROM PIR_LOCAL_BEM_CONTA_AUXILIAR WHERE COD_ITEM_CNT_AUX LIKE '15665' -- Vazia
SELECT * FROM PIR_CNT_CUSTO_ITEM_CNTAUX WHERE COD_ITEM_CNT_AUX LIKE '15665'
SELECT * FROM PIR_BEM_ALT_CLASSIF WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM PIR_RELATORIO_CTB_ESTOQUE WHERE ITEM_CNTAUX LIKE '15665'
SELECT * FROM CONF_LANC WHERE ITEM_CNTAUX LIKE '15665'

SELECT * FROM CC_DESTINO WHERE COD_ITEM_CNT_AUX LIKE '15665' -- Vazia
SELECT * FROM PIR_RENEGOCIACAO_TREC_NDO WHERE COD_ITEM_CNTAUX LIKE '15665' -- REANALISAR
SELECT * FROM PIR_CCORRENTE_CONTAS WHERE COD_ITEM_CNTAUX LIKE '15665'
SELECT * FROM CC_ORIGEM WHERE COD_ITEM_CNTAUX_ORIGEM LIKE '15665'
SELECT * FROM PIR_DETALHE_RELACAO_JURIDICA WHERE COD_ITEM_CNTAUX LIKE '15665'

SELECT * FROM LANCAMENTO WHERE ITEM_CNTAUX LIKE '15670'
SELECT * FROM PIR_ITEMSAI_CONF WHERE COD_ITEM_CNTAUX LIKE '15654'

UPDATE LANCAMENTO SET ITEM_CNTAUX = '143' WHERE ITEM_CNTAUX LIKE '15673';
UPDATE PIR_ITEMSAI_CONF SET COD_ITEM_CNTAUX = '143' WHERE COD_ITEM_CNTAUX LIKE '15673';

DELETE FROM ITEM_CNTAUX WHERE ITEM_CNTAUX LIKE '15673';


--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '143' WHERE ITEM_CNTAUX LIKE '15673';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '37850' WHERE ITEM_CNTAUX LIKE '15665';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '41728' WHERE ITEM_CNTAUX LIKE '15672';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '41785' WHERE ITEM_CNTAUX LIKE '15671';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '42447' WHERE ITEM_CNTAUX LIKE '15663';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '42864' WHERE ITEM_CNTAUX LIKE '15654';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '42998' WHERE ITEM_CNTAUX LIKE '15670';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '43007' WHERE ITEM_CNTAUX LIKE '15666';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '43693' WHERE ITEM_CNTAUX LIKE '15668';
--UPDATE ITEM_CNTAUX SET ITEM_CNTAUX = '43708' WHERE ITEM_CNTAUX LIKE '15669';

--23OUTUBRO

--Breakdown de bens 109921, 110276

SELECT * FROM NDO WHERE CODIGO IN ('COM159','COM086','COM170')
SELECT * FROM PRODUTOS WHERE CODPROD LIKE 'I0931'

SELECT * FROM BEM WHERE NUM_BEM IN (109921, 110276)

SELECT * FROM BEM WHERE TEX_HISTORICO LIKE '%21.5%'

SELECT * FROM PIR_HISTORICO_ITENSREQ WHERE NUM_BEM IN (109921, 110276)

SELECT NUM_BEM, DSC_BEM, VAL_BASE_PIS FROM BEM WHERE CODPROD LIKE 'S2116' AND NUM_BEM > 100000 AND VAL_BASE_PIS < 650 ORDER BY NUM_BEM

SELECT NUM_BEM, DSC_BEM, VAL_BASE_PIS FROM BEM WHERE CODPROD LIKE 'S2116' AND VAL_BASE_PIS = 76.5 ORDER BY NUM_BEM --34 bens 612.03

SELECT NUM_BEM, COD_OSI FROM BEM WHERE COD_OSI IN (SELECT COD_OSI FROM BEM WHERE CODPROD LIKE 'S2116' AND VAL_BASE_PIS = 76.5) AND VAL_BASE_PIS = 612.03 ORDER BY COD_OSI


SELECT * FROM BEM WHERE COD_OSI LIKE '2611606.51021310.03.2015.314020421'

SELECT * FROM PIR_TOMBAMENTO_LOG WHERE NUM_BEM = 110276

SELECT * FROM PIR_MOV_GERA_BEM WHERE NUM_BEM_FILHO = 110276 OR NUM_BEM_PAI = 110276

SELECT * FROM BEM_TIPO_LANCAMENT WHERE NUM_BEM = 110276

SELECT * FROM ITEM_ENTRADA WHERE NUM_BEM = 110276

SELECT * FROM PIR_PIL_BEM_ATIVO WHERE COD_BEM_ATIVO = 110276

SELECT NUMPEDC FROM ITENS_PED_COMPRA WHERE CODPROD IN ('I6321','I6189','I6324','I6325','S6756','S6759')-- Confirmado que só tem ela, com todos os itens

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '%54427' OR NUMPEDC LIKE '%54428' --COM170

-- Pablo x Lisboa

select mm.conta,
       mm.ccusto,
       mm.ctipo,
       SUM(coalesce(mm.valor_deb, 0)) VLR_DEBITO,
       SUM(coalesce(mm.valor_cre, 0)) VLR_CREDITO,
       Case
         When mm.ctipo = 'D' Then
          ABS(SUM(coalesce(mm.valor_deb, 0)) - SUM(coalesce(mm.valor_cre, 0)))
         Else
          ABS(SUM(coalesce(mm.valor_cre, 0)) -SUM(coalesce(mm.valor_deb, 0)))
       End SALDO_FINAL
  from lancamento mm
--where mm.ldata between '01-01-2010' and '31-12-2011'
where mm.ldata between '01-01-2010' and '31-12-2023'
   and mm.conta = '1.2.7.01.02.0001'
GROUP BY mm.conta, mm.ccusto, mm.ctipo
order BY mm.conta, mm.ccusto;


select mm.conta,
       mm.ccusto,
       mm.ctipo,
       SUM(coalesce(mm.valor_deb, 0)) VLR_DEBITO,
       SUM(coalesce(mm.valor_cre, 0)) VLR_CREDITO,
       Case
         When mm.ctipo = 'D' Then
          ABS(SUM(coalesce(mm.valor_deb, 0)) - SUM(coalesce(mm.valor_cre, 0)))
         Else
          ABS(SUM(coalesce(mm.valor_cre, 0)) -SUM(coalesce(mm.valor_deb, 0)))
       End SALDO_FINAL
  from lancamento mm
--where mm.ldata between '01-01-2010' and '31-12-2011'
where mm.ldata between '01-01-2010' and '31-12-2011'
	and mm.conta = '1.2.6.01.04.0003'
   --and mm.CCUSTO LIKE '3.01.0001'
GROUP BY mm.conta, mm.ccusto, mm.ctipo
order BY mm.conta, mm.ccusto;



select mm.conta,
       mm.ccusto,
       mm.ctipo,
       mm.valor_deb,
       mm.valor_cre,
       to_char(mm.LDATA,'dd-mm-yyyy')
  from lancamento mm
--where mm.ldata between '01-01-2010' and '31-12-2011'
where mm.ldata between '01-01-2008' and '31-12-2023'
	and mm.conta IN ('1.2.06.01.02.0004','1.2.06.01.02.0007','1.2.06.01.02.0009','1.2.06.01.02.0003','1.2.06.01.02.0002','1.2.06.01.02.0001')
   --and mm.CCUSTO LIKE '3.01.0001'
--GROUP BY mm.conta, mm.ccusto, mm.ctipo
--order BY mm.conta, mm.ccusto;
	ORDER BY mm.conta, mm.ldata

SELECT to_char(sysdate, 'yyyy-mm-dd') 

SELECT * FROM TITULO_PAG ORDER BY DAT_AUTORIZACAO DESC

SELECT * FROM PIR_TMP_FLUXO_REAL_CCUSTO WHERE COD_CCUSTO LIKE '2.01.0001' FETCH NEXT 10 ROWS ONLY

SELECT * FROM LANCAMENTO WHERE CONTA LIKE '1.2.7.01.02.0001' FETCH NEXT 10 ROWS ONLY

SELECT * FROM LANCAMENTO WHERE CONTA LIKE '1.2.7.01.02.0001' AND (LDATA between '01-01-2011' and '31-12-2011') FETCH NEXT 20 ROWS ONLY --30318,96

SELECT * FROM 

SELECT pcp.COD_CONTRATO, pcp.COD_CCUSTO_PADRAO, pcp.DAT_CADASTRO, tp.VALOR FROM PIR_CONTRATO_PASSIVO pcp
LEFT JOIN TITULO_PAG tp ON pcp.COD_CONTRATO = tp.COD_CONTRATO_PAS
WHERE pcp.COD_CCUSTO_PADRAO LIKE '3.01.0001'

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'PRE 031.21'

-- Prestação de contas - Nadja

------04/10/2023 -- prestação de contas

SELECT NUM_SEQ_PRESTCONTAS FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY --18772

SELECT * FROM PIR_PRESTACAO_CONTAS WHERE NUM_SEQ_PRESTCONTAS > 18600 ORDER BY NUM_SEQ_PRESTCONTAS DESC

SELECT * FROM PIRAMIDE.PIR_CCUSTO_PRESTCONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH NEXT 20 ROWS ONLY

ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH 18910

ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH (SELECT NUM_SEQ_PRESTCONTAS+1 FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY)

SELECT NUM_SEQ_PRESTCONTAS_AD.nextval from dual;

SELECT NUM_SEQ_PRESTCONTAS+1 FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY

-- CRIAR TRIGGER
-- Utilizar um update em vez de alter sequence

SELECT 

CREATE OR REPLACE TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS
Before Insert On PIR_PRESTACAO_CONTAS
For Each Row
Declare
  proximoVal Number;
Begin
  SELECT NUM_SEQ_PRESTCONTAS+1 INTO proximoVal FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY;
  ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH 19013;
End TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS;

-- Tentativa sugestão Cirilo
CREATE OR REPLACE TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS
Before Insert On PIR_PRESTACAO_CONTAS
For Each ROW
DECLARE
    maxid NUMBER;
    maxseq NUMBER;
    temp NUMBER;  -- without this variable Oracle would skip to query the sequence
Begin
  	SELECT MAX(NUM_SEQ_PRESTCONTAS) INTO maxid FROM PIR_PRESTACAO_CONTAS;
    SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO maxseq FROM DUAL;
    FOR i IN maxseq .. maxid LOOP
        SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO temp FROM DUAL;
    END LOOP;
End TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS;


SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL FROM DUAL;

DECLARE
    maxid NUMBER;
    maxseq NUMBER;
    temp NUMBER;  -- without this variable Oracle would skip to query the sequence
BEGIN
    SELECT MAX(NUM_SEQ_PRESTCONTAS) INTO maxid FROM PIR_PRESTACAO_CONTAS;
    SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO maxseq FROM DUAL;
    FOR i IN maxseq .. maxid LOOP
        SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO temp FROM DUAL;
    END LOOP;
END;

UPDATE NUM_SEQ_PRESTCONTAS_AD SET NEXTVAL = (SELECT NUM_SEQ_PRESTCONTAS+1 FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY);


ALTER TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS ENABLE --18774 em 25OUT2023


-- Demanda CLCO e COMUN estão desenvolvendo um projeto no SE-Suite referente ao processo de Patrocínios e Doações.

Eles estão tentando aproveitar a view_orcamento_conta_sesuite utilizada no processo de Compras para trazer as contas relacionadas ao patrocínio.

No entanto, as contas trazidas para o grid de dotações não estão coincidindo com as contas de patrocínio.

Contatos: Eduardo Reis e Adriana


SELECT * FROM VIEW_ORCAMENTO_CONTA_SESUITE WHERE CONTAS LIKE '%ATROC%NIO%'

CREATE OR REPLACE VIEW VIEW_ORCAMENTO_CONTA_SESUITE AS
SELECT

CASE
 WHEN  P.PLANO_CONTA IN ('7', '2021') THEN 'INVESTIMENTO'
 WHEN  P.PLANO_CONTA IN ('1', '2', '2014003999') THEN 'DESPESA'
END AS "ELEMENTO",

O.DESCRICAO AS "CUSTO",

C.DESCRICAO AS "CONTAS"
from
sco_itens_ver_orc d
inner join sco_versao_orcamento v on d.versao_orc = v.versao_orc and d.orcamento = v.orcamento and d.plano_conta = v.plano_conta
inner join
sco_plano_conta p on d.plano_conta = p.plano_conta
inner join sco_orcamento o ON d.orcamento = o.orcamento
inner join sco_conta c ON d.conta = c.conta
WHERE

--V.DATA_INICIAL >= '01/01/2021' and
d.plano_conta in ('1','2','2014003999' , '7', '2021')
and o.descricao not in('CONSOLIDADO GOV', 'CONSOLIDADO ADM', 'CONSOLIDADO CUSTO', 'CONSOLIDADO COM', 'CONSOLIDADO')

SELECT * FROM PIR_FLUXO_APROVACAO

SELECT * FROM USUARIO WHERE NOM_USUARIO LIKE '%GUILHERME%'

SELECT * FROM PIR_LOCAL_BEM_CONTA_AUXILIAR WHERE COD_ITEM_CNT_AUX LIKE '15665' -- Vazia

--24OUT

--Chamado Ana Rosa - clientes SINC
SELECT * FROM cliente_contato
SELECT * FROM CLIENTES WHERE NOME LIKE 'ARLANX%' --SEM E-MAIL CADASTRADO, COD 29
SELECT * FROM CLIENTES WHERE NOME LIKE 'CBVP%' --Não encontrado
SELECT * FROM CLIENTES WHERE NOME LIKE 'A.G.C%' --SEM E-MAIL CADASTRADO, COD 43241, 44803, 44781 diretoria@novatecltda.com.br
SELECT * FROM CLIENTES WHERE NOME LIKE 'ACH%' --SEM E-MAIL CADASTRADO, COD 15644 SEM E-MAIL CADASTRADO
SELECT CODIGO, EMAIL FROM CLIENTES WHERE NOME LIKE 'ALPARGA%' --SEM E-MAIL CADASTRADO, COD 44926 santiago@alpargatas.com
SELECT CODIGO, NOME, EMAIL FROM CLIENTES WHERE NOME LIKE 'CBA%' --SEM E-MAIL CADASTRADO, COD 44926 amara.ferraz@cba.com.br


SELECT text FROM all_views WHERE view_name = 'VW_DADOS_INADIMPLENCIA' -> Base do GGAS
Concluído que puxa da tabela CONTRATO_PONTO_CONS_EMAIL_COBR, campo coec_ds_email


SELECT * FROM copergas.VW_SINC_DADOS_INADIMPLENCIA@DBL_PIR_UNG (DBLINK PARA UNIGAS)

SELECT * FROM CLIENTES WHERE CODIGO LIKE '201855'

SELECT * FROM TI_PRODUTO_MAP WHERE COD_PRODUTO_PIR LIKE 'G0018'

SELECT * FROM TI_PRODUTO_MAP WHERE DSC_PRODUTO LIKE 'GAS INDUSTRIAL%'

SELECT * FROM TI_PRODUTO_MAP WHERE DSC_PRODUTO LIKE '%CBVP%'

SELECT * FROM TI_PRODUTO_MAP WHERE COD_SISTEMA_SI = 'GAS' ORDER BY COD_PRODUTO_SI

SELECT * FROM TI_PRODUTO_MAP ORDER BY COD_PRODUTO_SI

SELECT * FROM TI_PRODUTO_MAP WHERE COD_PRODUTO_SI = '8'

INSERT INTO TI_PRODUTO_MAP (COD_SISTEMA_SI, COD_PRODUTO_PIR, COD_PRODUTO_SI, DSC_PRODUTO) VALUES ('GAS','G0018','8','GAS INDUSTRIAL CBVP (VENDA)')

--Integração Unigas

SELECT * FROM TI_NF_SAIDA WHERE COD_SISTEMA_ORIGEM LIKE 'GAS' AND DAT_EMISSAO = TO_DATE('04-01-24','DD-MM-YY') ORDER BY DAT_EMISSAO DESC

SELECT * FROM TI_NF_SAIDA WHERE COD_SISTEMA_ORIGEM LIKE 'GAS' AND DAT_EMISSAO = TO_DATE('04-01-24','DD-MM-YY') ORDER BY DAT_EMISSAO DESC

SELECT * FROM TI_NF_SAIDA WHERE COD_SISTEMA_ORIGEM LIKE 'UNG' ORDER BY DAT_EMISSAO DESC



SELECT 
    CL.CLIE_CD, PC.POCN_DS ,COEC.COEC_DS_EMAIL  as EMAIL
    FROM CONTRATO_PONTO_CONSUMO@DBL_PIR_GGAS CPC 
    INNER JOIN CONTRATO_PONTO_CONS_ITEM_FATUR@DBL_PIR_GGAS CIF ON CPC.COPC_CD = CIF.COPC_CD
    INNER JOIN CONTRATO@DBL_PIR_GGAS C ON CPC.CONT_CD = C.CONT_CD
    INNER JOIN PONTO_CONSUMO@DBL_PIR_GGAS PC ON CPC.POCN_CD = PC.POCN_CD
    INNER JOIN CLIENTE@DBL_PIR_GGAS CL ON C.CLIE_CD_ASSINATURA = CL.CLIE_CD
    INNER JOIN CEP@DBL_PIR_GGAS CEP_PC ON CPC.CEP_CD_ENTREGA = CEP_PC.CEP_CD
    INNER JOIN MUNICIPIO@DBL_PIR_GGAS MUN_PC ON CEP_PC.MUNI_CD = MUN_PC.MUNI_CD
    --LEFT JOIN SEGMENTO@DBL_PIR_GGAS S ON S.SEGM_CD = PC.SEGM_CD
    LEFT JOIN CONTRATO_PONTO_CONS_EMAIL_COBR@DBL_PIR_GGAS COEC ON CPC.COPC_CD = COEC.COPC_CD AND 
    COEC.COEC_DS_EMAIL not in ('tesouraria@copergas.com.br', 'geti.copergas@gmail.com')
    WHERE C.CONT_IN_USO=1 and C.COSI_CD = 1 AND PC.POCN_DS LIKE 'RLANXEO%'


--Chamado Pedro - cadastro errado

SELECT COD_CCUSTO FROM BEM WHERE NUM_BEM = 115560

UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = 115466

SELECT * FROM LANCAMENTO FETCH FIRST 10 ROWS ONLY

SELECT * FROM PIR_HISTORICO_ITENSREQ WHERE NUM_BEM =115466 FETCH FIRST 10 ROWS ONLY



UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = 115290;


--30OUT

SELECT NUM_SEQ_PRESTCONTAS FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY --18828, 18831, 18856, 18878

SELECT * FROM PIR_PRESTACAO_CONTAS WHERE NUM_SEQ_PRESTCONTAS > 19000 ORDER BY NUM_SEQ_PRESTCONTAS DESC

SELECT * FROM PIRAMIDE.PIR_CCUSTO_PRESTCONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH NEXT 20 ROWS ONLY

ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH 19032

ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH (SELECT TO_NUMBER(NUM_SEQ_PRESTCONTAS)+1 FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY)

select setval('NUM_SEQ_PRESTCONTAS_AD', variable, true);

SELECT NUM_SEQ_PRESTCONTAS_AD.nextval from dual;

SELECT NUM_SEQ_PRESTCONTAS+1 FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY

-- CRIAR TRIGGER

CREATE OR REPLACE TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS
BEFORE INSERT ON PIR_PRESTACAO_CONTAS
FOR EACH ROW
BEGIN
  ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH (SELECT NUM_SEQ_PRESTCONTAS+1 FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY);
END TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS;

ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH 18812

SELECT NUM_SEQ_PRESTCONTAS+1 FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH FIRST ROW ONLY;

ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH 19035;

-- Verificar situação do e-mail
SELECT
MATRICULA,
CLIENTE,
TITULO,
EMAIL,
NOME_CLIENTE,
TO_CHAR(EMISSAO, 'DD/MM/YYYY') AS EMISSAO,
TO_CHAR(VENCIMENTO, 'DD/MM/YYYY') as DATA_VENCIMENTO_FATURA,
TO_CHAR(VALOR, 'FM999G999G990D90') as VALOR_FATURA,
CASE WHEN FORMAMEDICAO ='DIARIA' THEN '72 Horas'
 ELSE '30 Dias' END AS TEMPO 
FROM piramide.view_sinc_inadimplencia_fim
WHERE (to_date(CURRENT_DATE, 'DD/MM/YYY') = VENCIMENTO - 2) AND MATRICULA = '201500178'
ORDER BY MATRICULA


-- VIEW_SINC_INADIMPLENCIA_FIM
SELECT CODDOC, STATUS, CLIENTE, NOME_CLIENTE, COD_CGC_CPF, TITULO, NOSSO_NUMERO,
COD_REFERENCIA, EMISSAO, VENCIMENTO, DAT_COMPETENCIA, VALOR, MATRICULA,
TO_CHAR(ID) AS ID, RAZAOSOCIAL, APELIDO, CNPJ, to_char(EMAIL) AS EMAIL, TELEFONE, SEGMENTO,
ENDERECO, TO_CHAR(NUMERO) AS NUMERO, COMPLEMENTO,
BAIRRO, CEP, ESTADO, PAIS, STATUSCLIENTE,IDCLIENTEMESTRE, APELIDOCLIENTEMESTRE,
PERFILFATURAMENTO, IDPERFILFATURAMENTO, PRODUTO, TO_CHAR(TIPOTELEFONE) AS TIPOTELEFONE,
CIDADE_CLIENTE, UF_CLIENTE, 'UNG' AS VIEW_ORIGEM
,"FormaMedicao" AS FORMAMEDICAO
FROM piramide.vw_sinc_inadimp_app_ung

union
SELECT CODDOC, STATUS, CLIENTE, NOME_CLIENTE, COD_CGC_CPF, TITULO, NOSSO_NUMERO,
COD_REFERENCIA, EMISSAO, VENCIMENTO, DAT_COMPETENCIA, VALOR, MATRICULA,
TO_CHAR(ID) AS ID, RAZAOSOCIAL, APELIDO, CNPJ, to_char(EMAIL) as EMAIL, TELEFONE, SEGMENTO,
ENDERECO, TO_CHAR(NUMERO) AS NUMERO, COMPLEMENTO, BAIRRO, CEP, ESTADO, PAIS,
STATUSCLIENTE, IDCLIENTEMESTRE, APELIDOCLIENTEMESTRE, PERFILFATURAMENTO,
IDPERFILFATURAMENTO, PRODUTO, TO_CHAR(TIPOTELEFONE) AS TIPOTELEFONE,
CIDADE_CLIENTE, UF_CLIENTE,
'GGAS' AS VIEW_ORIGEM
,FORMAMEDICAO
FROM view_analise_inadimp_app_ggas
WHERE NOME_CLIENTE LIKE '%CBVP%'
/*)
GROUP BY TITULO
HAVING COUNT(TITULO) > 1*/

SELECT text FROM all_views WHERE view_name = 'VIEW_ANALISE_INADIMP_APP_GGAS'

SELECT * FROM CLIENTES

CREATE OR REPLACE VIEW VIEW_ANALISE_INADIMP_APP_GGAS AS


SELECT
t.coddoc,
t.status,
t.cliente,
c.nome AS Nome_cliente,
p.cod_cgc_cpf,
T.TITULO,
t.nosso_numero,
t.cod_referencia,
t.emissao,
t.vencimento,
t.dat_competencia,
t.valor,
(CASE WHEN (c.COD_CONTRATO IS NULL) THEN (SELECT COD_CONTRATO_ORIGEM FROM PIRAMIDE.TI_CLIENTE ticli
										WHERE ticli.COD_CLIENTE_DESTINO = t.CLIENTE
										AND COD_CONTRATO_ORIGEM IS NOT NULL
										AND rownum = 1)
 ELSE C.COD_CONTRATO END) AS MATRICULA,
--imp."MATRICULA",
imp."ID",
imp."RAZAOSOCIAL",
imp."APELIDO",
c.CGC AS CNPJ,
(CASE WHEN (imp."EMAIL" IS NULL) THEN (c.EMAIL)
 ELSE imp."EMAIL" END) AS EMAIL,
imp."TELEFONE",
imp."TIPOTELEFONE",
imp."PRODUTO",
imp."PERFILFATURAMENTO",
imp."IDPERFILFATURAMENTO",
imp."SEGMENTO",
imp."ENDERECO",
imp."NUMERO",
imp."COMPLEMENTO",
imp."BAIRRO",
imp."CEP",
imp."ESTADO",
imp."PAIS",
imp."STATUSCLIENTE",
imp."IDCLIENTEMESTRE",
imp."APELIDOCLIENTEMESTRE",
ci.dsc_municipio AS cidade_cliente,
ci.cod_uf AS uf_cliente,
imp."FORMAMEDICAO"
from titulo_rec t
inner join piramide.clientes c on t.cliente = c.codigo
inner join piramide.pessoa p on c.codigo = p.codigo
inner join pir_municipio ci on c.cod_municipio_cob = ci.cod_municipio
left join VW_DADOS_INADIMPLENCIA2@DBL_PIR_GGAS imp ON TO_CHAR(imp."MATRICULA")=TO_CHAR(c.COD_CONTRATO) AND imp.cnpj=p.cod_cgc_cpf
where
t.status in ('A','P')
AND imp."EMAIL" IS NULL AND C.EMAIL IS NULL
--comentado em 15/06/2023. Pois evellyn havia sinalizado que alguns clientes industriais mensais não estavam aparecendo
--and imp."FORMAMEDICAO" = 'MENSAL'


--31OUT

SELECT text FROM all_views WHERE view_name = 'VIEW_CONTROLE_INADIMPLENCIA2'

--07NOV

-- Problema de título não recebido 2368077 - Oriundo do GGAS. Havia uma baixa parcial (verificada na tabela TI_HISTORICO_REC)

SELECT * FROM TI_NF_SAIDA WHERE COD_SISTEMA_ORIGEM LIKE 'GAS' ORDER BY DAT_EMISSAO DESC

SELECT * FROM TI_DOCUMENTO_REC WHERE COD_DOCUMENTO_ORIGEM LIKE '746956.GAS' --NUM_SEQ_DOCUMENTO 2368077

SELECT * FROM TI_DOCUMENTO_REC WHERE COD_DOCUMENTO_ORIGEM LIKE '746956.GAS'

UPDATE TI_DOCUMENTO_REC SET COD_STATUS_REGISTRO = 'P' WHERE NUM_SEQ_DOCUMENTO =2368077

SELECT * FROM TI_DOCUMENTO_REC WHERE NUM_SEQ_DOCUMENTO =2368077

SELECT * FROM COD

SELECT * FROM TI_DOCUMENTO_REC WHERE COD_STATUS_REGISTRO LIKE 'NP'
SELECT * FROM TI_HISTORICO_REC WHERE NUM_SEQ_DOCUMENTO = 2368077 COD_DOCUMENTO_REC LIKE '746956.GAS' ORDER BY DAT_INCLUSAO_REGISTRO DESC

UPDATE TI_HISTORICO_REC SET COD_SISTEMA_ORIGEM = 'PIR' WHERE NUM_SEQ_DOCUMENTO = 2368077 -- Estava 'PIR'

--08NOV

SELECT * FROM PIR_ITEM_SOLICITACAO_VIAGEM WHERE NUM_SOLICITACAO = 1300

--UPDATE PIR_ITEM_SOLICITACAO_VIAGEM SET COD_STATUS = 'C' WHERE NUM_SOLICITACAO = 1300 AND NUM_ITEM = 3 --Estava F
--UPDATE PIR_ITEM_SOLICITACAO_VIAGEM SET COD_STATUS = 'C' WHERE NUM_SOLICITACAO = 1302 AND NUM_ITEM = 3 --Estava F

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '%54811'

--UPDATE PEDIDO_COMPRA SET STATUS = 'C' WHERE NUMPEDC = '54811'
--UPDATE PEDIDO_COMPRA SET STATUS = 'C' WHERE NUMPEDC = '54813'

438939
438935
438934
438933
438931
438938
438948
438942
438940
438944
438946
438947
438945
438941
438950
438943
438949
438930
438937
438936
438932

SELECT * FROM PIR_SOLICITACAO_VIAGEM WHERE NUM_SOLICITACAO = 1301

SELECT * FROM ITENS_PED_COMPRA WHERE NUMPEDC LIKE '%54811'

SELECT * FROM PIR_ITEM_SOLICITACAO_VIAGEM WHERE NUM_SOLICITACAO = 1301

--DELETE FROM PIR_ITEM_SOLICITACAO_VIAGEM WHERE NUM_SOLICITACAO = 1300 AND NUM_ITEM = 3
--DELETE FROM PIR_ITEM_SOLICITACAO_VIAGEM WHERE NUM_SOLICITACAO = 1302 AND NUM_ITEM = 3

--10NOV

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DTC 044.23'

UPDATE PIR_ITEM_CONTRATO_PASSIVO SET COD_CFOP = 1949 WHERE COD_CONTRATO = 'DTC 044.23'

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DTC 044.23'


SELECT * FROM NDO WHERE CODIGO = 'COM020'
SELECT * FROM CBT WHERE CODCBT = '02'

SELECT table_name FROM all_tab_columns WHERE column_name = 'MARCA'

SELECT
CODDOC,
MATRICULA,
CLIENTE,
TITULO,
EMAIL,
ID AS ID_CLIENTE,
NOME_CLIENTE,
TO_CHAR(EMISSAO, 'DD/MM/YYYY') AS EMISSAO,
TO_CHAR(VENCIMENTO, 'DD/MM/YYYY') as DATA_VENCIMENTO_FATURA,
TO_CHAR(VALOR, 'FM999G999G990D90') as VALOR_FATURA,
ENDERECO,
NUMERO,
IDPERFILFATURAMENTO,
BAIRRO,
CEP,
UF_CLIENTE,
CIDADE_CLIENTE,
TELEFONE,
'CELULAR' AS TIPOTELEFONE,
CASE WHEN FORMAMEDICAO ='DIARIA' THEN '72 Horas'
 ELSE '30 Dias' END AS TEMPO
FROM piramide.view_sinc_inadimplencia_fim WHERE (to_date(CURRENT_DATE, 'DD/MM/YYYY') = VENCIMENTO - 2) AND to_date(CURRENT_DATE, 'DD/MM/YYYY') != to_date('15/11/2023', 'DD/MM/YYYY') ORDER BY MATRICULA

--20NOV

select blocking_session, sid, serial#, wait_class, seconds_in_wait from v$session where blocking_session is not NULL order by blocking_session;

SELECT * FROM CLIENTES WHERE COD_CONTRATO = '201900724'

--21NOV

ALTER TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS DISABLE --21NOV

SELECT * FROM PIR_PRESTACAO_CONTAS ORDER BY num_seq_prestcontas desc

SELECT * FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH NEXT 40 ROWS ONLY; --Era 19031 em 22/11 às 1529

-- Tentativa sugestão Cirilo
CREATE OR REPLACE TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS
Before Insert On PIR_PRESTACAO_CONTAS
For Each ROW
DECLARE
    maxid NUMBER;
    maxseq NUMBER;
    temp NUMBER;  -- without this variable Oracle would skip to query the sequence
Begin
  	SELECT MAX(NUM_SEQ_PRESTCONTAS) INTO maxid FROM PIR_PRESTACAO_CONTAS;
    SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO maxseq FROM DUAL;
    FOR i IN maxseq .. maxid LOOP
        SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO temp FROM DUAL;
    END LOOP;
End TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS;

--Sugestão chat GPT
CREATE OR REPLACE TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS
Before Insert On PIR_PRESTACAO_CONTAS
For Each ROW
DECLARE
    PRAGMA AUTONOMOUS_TRANSACTION;  -- Declare autonomous transaction
    maxid NUMBER;
    maxseq NUMBER;
    temp NUMBER;  -- without this variable Oracle would skip to query the sequence
Begin
    SELECT MAX(NUM_SEQ_PRESTCONTAS) INTO maxid FROM PIR_PRESTACAO_CONTAS;
    SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO maxseq FROM DUAL;
    
    FOR i IN maxseq .. maxid LOOP
        SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL INTO temp FROM DUAL;
    END LOOP;
    
    COMMIT;  -- Commit the autonomous transaction
End TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS;

SELECT * FROM clientes WHERE cod_contrato = '201200663'

SELECT NUM_SEQ_PRESTCONTAS_AD.NEXTVAL FROM DUAL;


--24NOV - Ariane

SELECT * FROM FORNEC_EMPRESA ORDER BY DATA_CAD DESC

--Análise: últimos cadastros - 5037 e 5038 por ariane

(SELECT min(val_total_contrato) FROM PIR_CONTRATO_PASSIVO WHERE cod_contrato = 'DAF 031.20')


------04/10/2023 -- prestação de contas

SELECT * FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH NEXT 30 ROWS ONLY --19050 dia 29NOV
ALTER TRIGGER TRG_CORRIGE_SEQUENCE_PRESTACAO_CONTAS ENABLE --27NOV
ALTER SEQUENCE NUM_SEQ_PRESTCONTAS_AD RESTART START WITH 19035;

SELECT * FROM PEDIDO_COMPRA WHERE STATUS = 'R' ORDER BY DT_PEDIDO DESC FETCH NEXT 30 ROWS ONLY; --C, A, P, R, PR --Apenas 17 registros PR
--VAL_TOTAL_INTEGRAL

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DAF 031.22'
SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DAF%031_22'

SELECT * FROM ITENS_PED_COMPRA --DAF N° 095/10 ou DAF 095/10

SELECT table_name FROM all_tab_columns WHERE column_name = 'NUMPEDC'

SELECT * FROM CLIENTES WHERE FANTASIA LIKE '%UNILEVER%'

SELECT * FROM Fornec

SELECT pc.NUMPEDC, pc.VAL_TOTAL_INTEGRAL, f.NOME, pcp.COD_CONTRATO FROM Fornec f
INNER JOIN PIR_CONTRATO_PASSIVO pcp ON pcp.COD_FORNECEDOR = f.CODIGO
INNER JOIN PEDIDO_COMPRA pc ON pc.FORNECEDOR = pcp.COD_FORNECEDOR
WHERE pcp.COD_CONTRATO LIKE 'DAF 031.22'
--GROUP BY pc.NUMPEDC
FETCH NEXT 30 ROWS ONLY;

SELECT pc.NUMPEDC, f.NOME  FROM PEDIDO_COMPRA pc
INNER JOIN Fornec f ON f.CODIGO = pc.FORNECEDOR
--INNER JOIN PIR_CONTRATO_PASSIVO pcp ON pcp.COD_FORNECEDOR = f.CODIGO
WHERE pc.STATUS = 'R'
ORDER BY DT_PEDIDO DESC FETCH NEXT 30 ROWS ONLY;

SELECT * FROM PIR_PRESTACAO_CONTAS ORDER BY NUM_SEQ_PRESTCONTAS DESC FETCH NEXT 30 ROWS ONLY

--05DEZ

--08NOV -- Verificar e-mail a Cleudeni - erro de produto inválido para contrato ativo

SELECT * FROM ITENS_PED_COMPRA WHERE NUMPEDC LIKE '%53865'

UPDATE ITENS_PED_COMPRA SET CODPROD = 'SER293' WHERE NUMPEDC = '00053865' --Estava SER295

UPDATE ITENS_PED_COMPRA SET CODPROD = 'SER293' WHERE NUMPEDC IN ('00053443','00053865','00053917','00054444','00054807','00055097','00055120','00055125')

SELECT * FROM PEDIDO_COMPRA WHERE NUMPEDC LIKE '%55529' IN ('00053443','00053865','00053917','00054444','00054807','00055097','00055120','00055125') --Em 05DEZ ainda estão 'A' Em 11DEZ, 3 estavam em 'R'

--COD_PRODUTO = SER293

SELECT * FROM PIR_ITEM_SOLICITACAO_VIAGEM WHERE COD_AF IN (53443,53865,53917,54444,54807,55097,55120,55125)

UPDATE PIR_ITEM_SOLICITACAO_VIAGEM SET COD_PRODUTO = 'SER293' WHERE COD_AF IN (53443,53865,53917,54444,54807,55097,55120,55125)

SELECT * FROM PIR_ATRIBUTO_TITREC WHERE NUM_TITULO = '770060.GAS' ORDER BY NUM_TITULO DESC FETCH NEXT 30 ROWS ONLY

--07DEZ

--Consulta SINC para verificação da demanda de Gamboa

SELECT
CODDOC,
MATRICULA,
CLIENTE,
TITULO,
EMAIL,
ID AS ID_CLIENTE,
NOME_CLIENTE,
TO_CHAR(EMISSAO, 'DD/MM/YYYY') AS EMISSAO,
TO_CHAR(VENCIMENTO, 'DD/MM/YYYY') as DATA_VENCIMENTO_FATURA,
TO_CHAR(VALOR, 'FM999G999G990D90') as VALOR_FATURA,
ENDERECO,
NUMERO,
IDPERFILFATURAMENTO,
BAIRRO,
CEP,
UF_CLIENTE,
CIDADE_CLIENTE,
TELEFONE,
'CELULAR' AS TIPOTELEFONE,
CASE WHEN FORMAMEDICAO ='DIARIA' THEN '72 Horas'
 ELSE '30 Dias' END AS TEMPO
FROM piramide.view_sinc_inadimplencia_fim
WHERE (to_date(CURRENT_DATE, 'DD/MM/YYY') < VENCIMENTO - 2)
AND NOME_CLIENTE LIKE '%GUINLES%PARK%'
ORDER BY MATRICULA

--RES: MARLIN
--RES: MONTE EVEREST
--RES: guinles park

SELECT NUMPEDC, CODPROD FROM ITENS_PED_COMPRA FETCH FIRST 10 ROWS ONLY


SELECT CODDOC, MATRICULA, CLIENTE, TITULO, EMAIL, ID AS ID_CLIENTE, NOME_CLIENTE,
TO_CHAR(EMISSAO, 'DD/MM/YYYY') AS EMISSAO, TO_CHAR(VENCIMENTO, 'DD/MM/YYYY') as DATA_VENCIMENTO_FATURA, TO_CHAR(VALOR, 'FM999G999G990D90') as VALOR_FATURA,
ENDERECO, NUMERO, IDPERFILFATURAMENTO, BAIRRO, CEP, UF_CLIENTE, CIDADE_CLIENTE, TELEFONE, 'CELULAR' AS TIPOTELEFONE,
CASE WHEN FORMAMEDICAO ='DIARIA' THEN '72 Horas' ELSE '30 Dias' END AS TEMPO 
FROM piramide.view_sinc_inadimplencia_fim
FETCH NEXT 30 ROWS ONLY



-- 

CREATE OR REPLACE FORCE EDITIONABLE VIEW "PIRAMIDE"."VIEW_FATU_DELOITE_VOLU_PROD" ("COD_SERIE", "COD_NF", "COD_CLIENTE", "NOME", "VAL_NOTA", "COD_STATUS", "DAT_EMISSAO", "DESCRICAO", "VOLUME") AS 
  select

    s.cod_serie,
    s.cod_nf,
    s.cod_cliente,
    c.nome,
    s.val_nota,
    s.cod_status,
    s.dat_emissao, p.descricao, sum(i.qtd_faturada) as volume


    from
    pir_saidas s left join
    clientes c on s.cod_cliente = c.codigo
   INNER JOIN PIR_ITENS_SAIDAS I ON S.COD_NF = I.COD_NF AND S.COD_SERIE = I.COD_SERIE AND S.COD_FILIAL = I.COD_FILIAL
   INNER JOIN PRODUTOS P ON I.COD_PRODUTO = P.CODPROD
    where
    s.cod_serie in('01', '5') and s.cod_status = 'F'
    --and cod_nf not in ('197735', '197740', '040503', '040461', '040238', '040132', '040129', '039820', '039820')
    and s.dat_emissao >= '01/01/2022' and s.dat_emissao <= '30/04/2023' -- Página
    --AND COD_CLIENTE IN('151', '152', '153')
    group by s.cod_serie,
    s.cod_nf,
    s.cod_cliente,
    c.nome,
    s.val_nota,
    s.cod_status,
    s.dat_emissao, p.descricao;

SELECT * FROM PRODUTOS WHERE CODPROD = 'C0390'

SELECT * FROM PIR_ALCADA WHERE COD_ALCADA IN ('000127','000123','000028')

UPDATE PIR_ALCADA SET NUM_TIPO = 4, COD_FLUXO = 200 WHERE COD_ALCADA = '000127' -- Estava 3, 204, respectivamente

SELECT * FROM FLUXO

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_PRODUTO = 'C0390' WHERE COD_CONTRATO LIKE 'DAF 011.23' --DAF 075.20

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_CONTRATO = 'DAF 075.20'

SELECT * FROM CFOP WHERE CODIGO = '1556'

SELECT * FROM NDO WHERE CODIGO = 'COM040' --USO E CONSUMO DENTRO DO ESTADO

SELECT * FROM CBT WHERE CODCBT = '05'

SELECT * FROM PEDIDO_COMPRA WHERE COD_ALCADA = '000127' AND FORNECEDOR = '3464'

SELECT * FROM PEDIDO_COMPRA WHERE FORNECEDOR = '3464' --Alçada correta ou 000123 ou 000028 conforme contratos similares com o mesmo fornecedor (vide contrato DAF 075.20)

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DAF 075.20'

SELECT * FROM PIR_ALCADA_CLASSIFICACAO WHERE COD_ALCADA = '000127'

SELECT * FROM TIPO_MATERIAL WHERE CODTIP IN ('001','003','004')

-- 003 CONSUMO
-- 001 IMOBILIZADO
-- 004 SERVIÇOS

-- 02JAN2024

SELECT * FROM PRODUTOS WHERE CODPROD = 'C0390'

SELECT * FROM PIR_ALCADA WHERE COD_ALCADA IN ('000127','000123','000028')

UPDATE PIR_ALCADA SET NUM_TIPO = 3, COD_FLUXO = 204 WHERE COD_ALCADA = '000127' -- Estava 3, 204, respectivamente

SELECT * FROM FLUXO

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_PRODUTO = 'C0390' WHERE COD_CONTRATO LIKE 'DAF 011.23' --DAF 075.20

SELECT * FROM PIR_ITEM_CONTRATO_PASSIVO WHERE COD_CONTRATO = 'DAF 075.20'

SELECT * FROM CFOP WHERE CODIGO = '1556'

SELECT * FROM NDO WHERE CODIGO = 'COM040' --USO E CONSUMO DENTRO DO ESTADO

SELECT * FROM CBT WHERE CODCBT = '05'

SELECT * FROM PEDIDO_COMPRA WHERE COD_ALCADA = '000127' AND FORNECEDOR = '3464'

SELECT * FROM PEDIDO_COMPRA WHERE FORNECEDOR = '3464' --Alçada correta ou 000123 ou 000028 conforme contratos similares com o mesmo fornecedor (vide contrato DAF 075.20)

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE COD_CONTRATO LIKE 'DAF 075.20'

SELECT * FROM PIR_CONTRATO_PASSIVO WHERE cod_fornecedor = '3483'

SELECT * FROM PIR_ALCADA_CLASSIFICACAO WHERE COD_ALCADA = '000127'

SELECT * FROM PIR_TIPO_CONTRATO WHERE COD_ALCADA = '000127'

SELECT * FROM PIR_FLUXO_APROVACAO

SELECT * FROM TIPO_MATERIAL WHERE CODTIP IN ('001','003','004')

-- 003 CONSUMO
-- 001 IMOBILIZADO
-- 004 SERVIÇOS

-- Observando as alçadas 000123 ou 000028 já utilizada em contratos similares com o mesmo fornecedor (vide contrato DAF 075.20) do contrato 'DAF 011.23',
--verificamos que o cod_fluxo é 200 (FLUXO_COMPRAS_1_COMPRADOR) e não 204 (FLUXO_COMPRAS_TI) como consta no 000127. No entanto, o contrato em tela trata-se de fornecimento de água, nada tendo a ver com um possível
-- fluxo de aprovação relacionado

-- Chamado de Isabelle

SELECT COD_CCUSTO FROM BEM WHERE NUM_BEM = 371

UPDATE BEM SET COD_CCUSTO = '2.02.0458' WHERE NUM_BEM = 118321

SELECT * FROM BEM WHERE NUM_BEM = 118321

-- Atualização de situação de nota cancelada no ERP

784994

SELECT COD_NF_ORIGEM, COD_OPERACAO_REGISTRO, COD_STATUS_REGISTRO, dsc_erro_registro
FROM TI_NF_SAIDA
WHERE COD_NF_ORIGEM = '438940'
 
SELECT nfe_nr_documento_fiscal, NFE_TM_ULTIMA_ALTERACAO,NFE_SIS_STATUS
FROM NFE
WHERE nfe_nr_documento_fiscal = '438940'

UPDATE NFE
SET
NFE_TM_ULTIMA_ALTERACAO = systimestamp
WHERE nfe_nr_documento_fiscal = '438940'
 
UPDATE TI_NF_SAIDA
SET
COD_STATUS_REGISTRO = 'P',
DSC_ERRO_REGISTRO = '',
COD_OPERACAO_REGISTRO = 'C'
WHERE COD_NF_ORIGEM ='438550';

SELECT * FROM TI_NF_SAIDA ORDER BY DAT_INCLUSAO_REGISTRO DESC -- WHERE COD_NF_ORIGEM = '00000000';
SELECT * FROM TI_NF_SAIDA ORDER BY DAT_EMISSAO DESC -- WHERE COD_NF_ORIGEM = '00000000';

SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE COD_NOTA_FISCAL = 600 AND COD_SISTEMA_ORIGEM = 'GAS'

SELECT * FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM = 800595

UPDATE TI_NOTA_FISCAL_ENTRADA SET COD_STATUS_REGISTRO = 'NP', DSC_ERRO_REGISTRO = ''  WHERE COD_NOTA_FISCAL = 600 AND COD_SISTEMA_ORIGEM = 'GAS'

--Total de créditos (2268350.39) não equivale ao total de débitos (2303134.58). Documento contábil: 600. Verifique a configuração contábil dos lançamentos.

-- 2108132.33

SELECT * FROM TI_NOTA_ENTRADA_FISCAL ORDER BY DAT_EMISSAO DESC

UPDATE TI_NF_SAIDA
SET COD_STATUS_NFEL = 'TP', COD_OPER_NFEL = 'EN', COD_STATUS_OPER_NFEL = 'P'
WHERE COD_NF_ORIGEM ='438950';

UPDATE PIR_SAIDAS
SET COD_STATUS_NFEL = 'TP', COD_OPER_NFEL = 'EN', COD_STATUS_OPER_NFEL = 'P'
WHERE COD_NF_ORIGEM = '438950'

SELECT * FROM PIR_SAIDAS ORDER BY DAT_INCLUSAO_REGISTRO DESC

--438550 -- 5/01

SELECT * FROM NFE
SELECT * FROM TI_NF_SAIDA
SELECT * FROM PIR_SAIDAS


SELECT *
FROM PIR_SAIDAS AS OF TIMESTAMP TIMESTAMP '2023-01-04 23:59:59.999999999'
WHERE COD_NF_ORIGEM = '438550'

SELECT * FROM TI_NOTA_FISCAL_ENTRADA

SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE cod_nota_fiscal IN ('598','596','588','585','573','572','571','563','561','560','553','547','536','512','507')

DELETE FROM TI_NOTA_FISCAL_ENTRADA
WHERE cod_nota_fiscal IN ('598','596','588','585','573','572','571','563','561','560','553','536','512','507')

DELETE FROM TI_NOTA_FISCAL_ENTRADA
WHERE cod_nota_fiscal IN ('598','596','588','585','573','572','571','563','561','560','553','536','512','507')

'547'

SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE cod_nota_fiscal IN ('600') AND COD_SERIE = '6'

- Campo DSC_ERRO_REGISTRO -  Origem da mensagem: Pirâmide. Total de créditos (160218.06) não equivale ao total de débitos (195002.25). Documento contábil: 600. Verifique a configuração contábil dos lançamentos.

SELECT * FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM = 800595

SELECT sum(VAL_ITEM) FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM = 800595

UPDATE TI_NOTA_FISCAL_ENTRADA SET COD_STATUS_REGISTRO = 'NP' WHERE cod_nota_fiscal IN ('600')

SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE cod_nota_fiscal = '547' --IN ('598','596','588','585','573','572','571','567','563','561','560','553','547','536','512','507')

SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE cod_nota_fiscal IN ('547','601','602') AND COD_SERIE = '6' --800542, 800596, 800597

SELECT * FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM IN ('547','601','602') AND COD_SERIE = '6'

SELECT * FROM Produtos WHERE CODPROD IN ('SER066','S0119','S1355','S2392','S0101')

-- 

--DELETE FROM TI_NOTA_FISCAL_ENTRADA WHERE cod_nota_fiscal IN ('547') AND COD_SISTEMA_ORIGEM = 'PIR'
--DELETE FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE cod_nota_fiscal IN ('547')
DELETE FROM TI_NOTA_FISCAL_ENTRADA WHERE cod_nota_fiscal IN ('547')
DELETE FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM IN ('547')

SELECT * FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM = '800595'

-- Erro apresentado

Origem da mensagem: Pirâmide. Total de créditos (160218.06) não equivale ao total de débitos (195002.25). Documento contábil: 600. Verifique a configuração contábil dos lançamentos.


-- SITUAÇÃO 600

SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE COD_NOTA_FISCAL = 439423
UNION
SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE COD_NOTA_FISCAL = 600

SELECT * FROM TI_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM = 800595

-- Origem da mensagem: Pirâmide. Total de créditos (2268350.39) não equivale ao total de débitos (2303134.58). Documento contábil: 600. Verifique a configuração contábil dos lançamentos.

-- aba geral o imposto não afeta, imposto lanço a contrapartida - aba de produtos subtrai do imposto (debito)

-- vendo produto - grupo almoxarifado

SELECT * FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM = 800595

--DELETE FROM TI_ITEM_NOTA_FISCAL_ENTRADA WHERE NUM_SEQUENCIAL_ENTRADA_ORIGEM = 800595
--DELETE FROM TI_NOTA_FISCAL_ENTRADA WHERE COD_NOTA_FISCAL = 600 AND COD_SISTEMA_ORIGEM = 'GAS'


-- ALTERAR CAMPO DAT_ALTERACAO_REGISTRO em TI_NOTA_FISCAL_ENTRADA e altera a data para alguns minutos antes na VIEW_TI_NF_ENT_GGAS_PIR

update entrada 
set     cod_oper_nfel = 'EN', 
        cod_status_oper_nfel = 'P', 
        cod_status_nfel = 'TP' 
where nf = '600' 
and serie = '6'


SELECT * FROM ENTRADA 
where nf IN ('441504','441587')
and serie = '5' 

SELECT * FROM TI_NOTA_FISCAL_ENTRADA



-- 438982 - adiantamento não foi para o pirâmide

SELECT * FROM ENTRADA WHERE FATURA = '438982'

SELECT * FROM TI_DOCUMENTO_REC WHERE COD_SISTEMA_ORIGEM = 'GAS' AND COD_DOCUMENTO_ORIGEM = '785591.GAS'







SELECT CODDOC, MATRICULA, CLIENTE, TITULO, EMAIL, ID AS ID_CLIENTE, NOME_CLIENTE,
TO_CHAR(EMISSAO, 'DD/MM/YYYY') AS EMISSAO, TO_CHAR(VENCIMENTO, 'DD/MM/YYYY') as DATA_VENCIMENTO_FATURA, TO_CHAR(VALOR, 'FM999G999G990D90') as VALOR_FATURA,
ENDERECO, NUMERO, IDPERFILFATURAMENTO, BAIRRO, CEP, UF_CLIENTE, CIDADE_CLIENTE, TELEFONE, 'CELULAR' AS TIPOTELEFONE,
CASE WHEN FORMAMEDICAO ='DIARIA' THEN '72 Horas' ELSE '30 Dias' END AS TEMPO 
FROM piramide.view_sinc_inadimplencia_fim


-- 16JAN

UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM IN (118792,118793,118794,118795);


UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '117655';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '117675';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118722';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118723';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118724';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118725';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118726';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118727';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118728';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118729';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118730';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118731';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118732';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118733';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118734';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118735';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118736';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118737';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118738';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118739';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118740';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118741';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118742';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118743';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118744';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118745';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118746';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118747';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118748';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118749';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118750';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118751';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118752';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118753';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118754';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118755';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118756';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118757';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118758';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118759';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118760';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118761';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118762';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118763';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118764';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118765';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118766';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118767';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118768';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118769';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118770';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118771';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118772';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118773';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118774';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118775';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118776';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118777';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118778';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118779';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118780';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118781';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118782';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118783';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118784';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118785';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118786';
UPDATE BEM SET COD_CCUSTO = '2.06.0068' WHERE NUM_BEM = '118787';



--  785614 	439691 	201000382 	S 	ROSANGELA MAGGI DE SOUSA 	EDF. CONDE DE NASSAU - APT 701

SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE 'CACULINHA COMBUSTIVEIS%' --44026

SELECT COD_CLIENTE_ORIGEM FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE 'ROSANGELA MAGGI%' --206 COD_SISTEMA_ORIGEM = GAS 382 COD_CLIENTE_DESTINO

SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE 'ROSANGELA MAGGI%' --206 COD_SISTEMA_ORIGEM = GAS 382 COD_CLIENTE_DESTINO

Select s.COD_CLIENTE_ORIGEM as CLIENTE_NOTA, s.DSC_ERRO_REGISTRO AS ERRO_NOTA,             c.COD_CLIENTE_ORIGEM AS TI_CLIENTE, c.COD_CLIENTE_DESTINO, c.COD_STATUS_REGISTRO AS STATUS_TI_CLIENTE, 
CE.COD_CLIENTE_ORIGEM AS TI_CLIENTE_EMPRESA,  CE.COD_STATUS_REGISTRO AS STATUS_TI_CLIENTE_EMPRESA 
FROM ti_nf_Saida s 
left join ti_cliente c on s.COD_CLIENTE_ORIGEM = c.COD_CLIENTE_ORIGEM and s.COD_SISTEMA_ORIGEM = c.COD_SISTEMA_ORIGEM and c.COD_SISTEMA_ORIGEM = 'GAS'
LEFT JOIN TI_CLIENTE_EMPRESA CE ON c.COD_CLIENTE_ORIGEM = CE.COD_CLIENTE_ORIGEM AND CE.COD_SISTEMA_ORIGEM = 'GAS'
where s.cod_Status_registro = 'NP' AND s.COD_SISTEMA_ORIGEM = 'GAS';

SELECT * FROM CLIENTES WHERE CODIGO IN ('682','753','1544','7162')


SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE '%AURORA DO CAIS%' --COD_CLIENTE_ORIGEM = 44791 = DESTINO

SELECT * FROM TI_NF_SAIDA WHERE COD_NF_ORIGEM = '439691'

SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE '%AURORA DO CAIS%' --COD_CLIENTE_ORIGEM = 44791 = DESTINO

DELETE FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE 'ROSANGELA MAGGI%' AND COD_SISTEMA_ORIGEM = 'GAS'


SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE 'CRISTIANE PEREIRA JOB%'

SELECT * FROM TI_CLIENTE_EMPRESA WHERE COD_CLIENTE_ORIGEM = '40570'

SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE 'ROSANGELA MAGGI%' --COD_CLIENTE_ORIGEM = 44791 = DESTINO

SELECT * FROM TI_NF_SAIDA WHERE COD_NF_ORIGEM = '439691'

UPDATE TI_NF_SAIDA SET DSC_ERRO_REGISTRO = '', 

Select s.COD_CLIENTE_ORIGEM as CLIENTE_NOTA, s.DSC_ERRO_REGISTRO AS ERRO_NOTA,             c.COD_CLIENTE_ORIGEM AS TI_CLIENTE, c.COD_CLIENTE_DESTINO, c.COD_STATUS_REGISTRO AS STATUS_TI_CLIENTE, 
CE.COD_CLIENTE_ORIGEM AS TI_CLIENTE_EMPRESA,  CE.COD_STATUS_REGISTRO AS STATUS_TI_CLIENTE_EMPRESA 
FROM ti_nf_Saida s 
left join ti_cliente c on s.COD_CLIENTE_ORIGEM = c.COD_CLIENTE_ORIGEM and s.COD_SISTEMA_ORIGEM = c.COD_SISTEMA_ORIGEM and c.COD_SISTEMA_ORIGEM = 'GAS'
LEFT JOIN TI_CLIENTE_EMPRESA CE ON c.COD_CLIENTE_ORIGEM = CE.COD_CLIENTE_ORIGEM AND CE.COD_SISTEMA_ORIGEM = 'GAS'
where s.cod_Status_registro = 'NP' AND s.COD_SISTEMA_ORIGEM = 'GAS';


UPDATE TI_CLIENTE SET COD_OPERACAO_REGISTRO = 'A', COD_STATUS_REGISTRO = 'NP' WHERE COD_CLIENTE_ORIGEM = '40570' AND COD_SISTEMA_ORIGEM = 'GAS'

UPDATE TI_CLIENTE_EMPRESA SET COD_OPERACAO_REGISTRO ='A', DSC_ERRO_REGISTRO = '' WHERE COD_CLIENTE_ORIGEM = '40570' AND COD_SISTEMA_ORIGEM = 'GAS'

UPDATE TI_CLIENTE SET COD_STATUS_REGISTRO = 'NP', DSC_ERRO_REGISTRO ='' WHERE NOM_CLIENTE LIKE 'ROSANGELA MAGGI%' AND COD_SISTEMA_ORIGEM = 'GAS'

-- 18JAN integração das notas 787983 e 788283

SELECT * FROM TI_NF_SAIDA WHERE COD_FATURA_ORIGEM IN ('787983','788283') --Clientes 495 e 565 não integrado NO piramide

SELECT * FROM TI_CLIENTE WHERE COD_CLIENTE_ORIGEM IN ('495','565') AND COD_SISTEMA_ORIGEM = 'GAS' -- AMBOS TINHAM REGISTROS INSERIDOS PELO UNIGAS

Select s.COD_CLIENTE_ORIGEM as CLIENTE_NOTA, s.DSC_ERRO_REGISTRO AS ERRO_NOTA,             c.COD_CLIENTE_ORIGEM AS TI_CLIENTE, c.COD_CLIENTE_DESTINO, c.COD_STATUS_REGISTRO AS STATUS_TI_CLIENTE, 
CE.COD_CLIENTE_ORIGEM AS TI_CLIENTE_EMPRESA,  CE.COD_STATUS_REGISTRO AS STATUS_TI_CLIENTE_EMPRESA 
FROM ti_nf_Saida s 
left join ti_cliente c on s.COD_CLIENTE_ORIGEM = c.COD_CLIENTE_ORIGEM and s.COD_SISTEMA_ORIGEM = c.COD_SISTEMA_ORIGEM and c.COD_SISTEMA_ORIGEM = 'GAS'
LEFT JOIN TI_CLIENTE_EMPRESA CE ON c.COD_CLIENTE_ORIGEM = CE.COD_CLIENTE_ORIGEM AND CE.COD_SISTEMA_ORIGEM = 'GAS'
where s.cod_Status_registro = 'NP' AND s.COD_SISTEMA_ORIGEM = 'GAS';

UPDATE TI_CLIENTE SET COD_STATUS_REGISTRO = 'NP', COD_OPERACAO_REGISTRO = 'A', DSC_ERRO_REGISTRO = '' WHERE COD_CLIENTE_ORIGEM IN ('495','565') AND COD_SISTEMA_ORIGEM = 'GAS'

UPDATE TI_CLIENTE_EMPRESA SET COD_STATUS_REGISTRO = 'NP', COD_OPERACAO_REGISTRO ='A', DSC_ERRO_REGISTRO = '' WHERE COD_CLIENTE_ORIGEM IN ('495','565') AND COD_SISTEMA_ORIGEM = 'GAS'

SELECT * from TI_CLIENTE_EMPRESA WHERE COD_CLIENTE_ORIGEM IN ('495','565') AND COD_SISTEMA_ORIGEM = 'GAS'

SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE 'CRISTIANE PEREIRA JOB' AND COD_SISTEMA_ORIGEM = 'GAS'

-- nota 788773 fatura 442111 AURISTTON MENDES TEIXEIRA DE VASCONCELOS

SELECT * FROM TI_NF_SAIDA WHERE COD_FATURA_ORIGEM IN ('788773') --Clientes 6614 não integrado NO piramide

SELECT * FROM TI_CLIENTE WHERE COD_CLIENTE_ORIGEM IN ('6614') AND COD_SISTEMA_ORIGEM = 'GAS' -- AMBOS TINHAM REGISTROS INSERIDOS PELO UNIGAS

UPDATE TI_CLIENTE SET COD_STATUS_REGISTRO = 'NP', COD_OPERACAO_REGISTRO = 'A', DSC_ERRO_REGISTRO = '' WHERE COD_CLIENTE_ORIGEM IN ('6614') AND COD_SISTEMA_ORIGEM = 'GAS'

UPDATE TI_CLIENTE_EMPRESA SET COD_STATUS_REGISTRO = 'NP', COD_OPERACAO_REGISTRO ='A', DSC_ERRO_REGISTRO = '' WHERE COD_CLIENTE_ORIGEM IN ('6614') AND COD_SISTEMA_ORIGEM = 'GAS'

-- posto IND APR Olinda APR COMBUSTIVEIS LTDA 	POSTO IND - APR OLINDA 

SELECT * FROM TI_CLIENTE WHERE NOM_CLIENTE LIKE '%APR COMBUSTIVEIS LTDA%' -- COD_CLIENTE_ORIGEM 43708

SELECT * FROM TI_NF_SAIDA WHERE COD_FATURA_ORIGEM IN ('788773') --Clientes 6614 não integrado NO piramide

SELECT * FROM TI_CLIENTE WHERE DAT_PROCESSAMENTO_REGISTRO <> NULL WHERE COD_CLIENTE_ORIGEM IN ('6614') AND COD_SISTEMA_ORIGEM = 'GAS' -- AMBOS TINHAM REGISTROS INSERIDOS PELO UNIGAS

UPDATE TI_CLIENTE SET COD_STATUS_REGISTRO = 'NP', COD_OPERACAO_REGISTRO = 'A', DSC_ERRO_REGISTRO = '' WHERE COD_CLIENTE_ORIGEM IN ('43708') AND COD_SISTEMA_ORIGEM = 'GAS'

UPDATE TI_CLIENTE_EMPRESA SET COD_STATUS_REGISTRO = 'NP', COD_OPERACAO_REGISTRO ='A', DSC_ERRO_REGISTRO = '' WHERE COD_CLIENTE_ORIGEM IN ('43708') AND COD_SISTEMA_ORIGEM = 'GAS'

-- Devolução da 745309 NF 404391

SELECT * FROM TI_HISTORICO_REC WHERE COD_DOCUMENTO_ORIGEM = '745309.GAS'

UPDATE TI_HISTORICO_REC SET COD_STATUS_REGISTRO = 'NP' WHERE COD_DOCUMENTO_ORIGEM = '745309.GAS'

SELECT * FROM TI_DOCUMENTO_REC WHERE COD_SISTEMA_ORIGEM = 'GAS' AND COD_DOCUMENTO_ORIGEM = '745309.GAS'

UPDATE TI_DOCUMENTO_REC SET COD_OPERACAO_REGISTRO = 'A', COD_STATUS_REGISTRO = 'NP' WHERE COD_SISTEMA_ORIGEM = 'GAS' AND COD_DOCUMENTO_ORIGEM = '784980.GAS'

--26JAN

-- Caso insert em massa

SELECT DBMS_METADATA.GET_DDL('TABLE', 'PIR_ATRIBUTO_TITREC') AS DDL
FROM DUAL;
  
SELECT * FROM PIR_ATRIBUTO_TITREC WHERE NUM_TITULO = 'SABOREBEIJO.4'

SELECT * FROM PIR_ATRIBUTO_TITREC WHERE NUM_TITULO = '20170118020'

--30JAN

--SELECTS de CIRILO

SELECT 
       --COUNT(DISTINCT(TR.TITULO)) AS QTDE,
       CODDOC, 
       TR.VALOR,
       TR.FILIAL,
       TR.titulo,
       TR.VENCIMENTO,
       TR.STATUS,
       --ATC.DSC_ATRIBUTO,
       --ATC.COD_TIPO_ATRIBUTO,
       TR.CLIENTE AS COD_CLIENTE,
       C.NOME,
       C.EMAIL
FROM TITULO_REC TR            
LEFT JOIN  CLIENTES C ON TR.CLIENTE = C.CODIGO
--LEFT JOIN PIRAMIDE.PIR_ATRIBUTO_TITREC ATC ON ATC.NUM_TITULO = TR.TITULO AND ATC.COD_FILIAL = TR.FILIAL AND atc.COD_TIPO_ATRIBUTO = 'tipodoc'
WHERE 
TR.STATUS NOT IN ('S', 'C') 
AND tr.cliente not in('151', '152', '153', '190', '191', '189')
and TR.TITULO NOT IN ('906753344','0906753344', '289523', '290773', '294892', '296967')
and TR.TITULO NOT IN  ('000242/1.1', '000232/1.1', '000233/1.1', '000230/1.1', '000231/1.1', '000234/1.1', '31', '32', '000270/1.1', 'ND GFIN 017/2023')
and tr.titulo not in ('163796.S1', '163788.S1')
--AND (DSC_ATRIBUTO IN ('CJUR', 'RNEST - Depósitos Judiciais') or DSC_ATRIBUTO IS NULL)
AND tr.status <> 'L' -- Adicionado dia 30JAN2024
AND tr.VENCIMENTO < sysdate --Adicionado dia 30JAN2024
GROUP BY 
       CODDOC, 
       TR.VALOR,
       TR.FILIAL,
       TR.titulo,
       TR.VENCIMENTO,
       TR.STATUS,
       TR.CLIENTE,
       C.NOME,
       C.EMAIL
       
SELECT * FROM CLIENTES
      

      
select SUM(HR.VALOR_PAG) AS VALOR_PAG,
       HR.DATA_PAG,
       HR.TITULO,
       HR.FILIAL,
       TR.CLIENTE AS COD_CLIENTE
from PIRAMIDE.TITULO_REC TR INNER JOIN PIRAMIDE.HISTORICO_REC HR ON TR.TITULO = HR.TITULO
GROUP BY DATA_PAG,
       HR.TITULO,
       HR.FILIAL,
       TR.CLIENTE;
      
      
SELECT * FROM PIRAMIDE.VW_ULTIMO_PAGAMENTO_POR_TITULO;      

